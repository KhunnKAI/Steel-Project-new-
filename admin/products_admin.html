<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ - ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter';
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        .navbar-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            font-size: 24px;
            cursor: pointer;
            z-index: 1001;
            color: #333;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: none;
            transition: all 0.3s ease;
        }

        .navbar-toggle:hover {
            background: #f8f9fa;
            transform: scale(1.05);
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        .main-content {
            flex: 1;
            padding: 30px;
            margin-left: 260px;
            transition: all 0.3s ease;
            min-height: 100vh;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        }

        .header h1 {
            font-size: 28px;
            color: #333;
            font-weight: 600;
        }

        .search-add {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .search-container {
            position: relative;
        }

        .search-container input[type="text"] {
            padding: 12px 45px 12px 15px;
            width: 350px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .search-container input[type="text"]:focus {
            outline: none;
            border-color: #990000;
            box-shadow: 0 0 0 3px rgba(153, 0, 0, 0.1);
        }

        .search-container i {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }

        .add-btn {
            padding: 12px 24px;
            background: linear-gradient(45deg, #990000, #cc0000);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(153, 0, 0, 0.3);
        }

        .filters-section {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            padding: 25px 30px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            position: relative;
        }

        .filters-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #990000, #cc0000, #ff6b6b);
            border-radius: 20px 20px 0 0;
        }

        .filters-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .filters-header h3 {
            color: #333;
            font-size: 18px;
            font-weight: 600;
            margin: 0;
        }

        .filters-header i {
            color: #990000;
            font-size: 20px;
        }

        .filters-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 20px;
            align-items: end;
        }

        .filter-group {
            position: relative;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .filter-group label {
            font-size: 13px;
            color: #555;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .filter-group select,
        .filter-group input[type="date"] {
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            font-size: 14px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            background: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            position: relative;
        }

        .filter-group select:hover,
        .filter-group input[type="date"]:hover {
            border-color: #990000;
            box-shadow: 0 4px 12px rgba(153, 0, 0, 0.15);
            transform: translateY(-1px);
        }

        .filter-group select:focus,
        .filter-group input[type="date"]:focus {
            outline: none;
            border-color: #990000;
            box-shadow: 0 0 0 4px rgba(153, 0, 0, 0.1), 0 4px 12px rgba(153, 0, 0, 0.15);
            transform: translateY(-1px);
        }

        .date-range-group {
            grid-column: span 2;
            display: flex;
            gap: 15px;
            align-items: end;
            background: rgba(153, 0, 0, 0.03);
            padding: 20px;
            border-radius: 15px;
            border: 2px dashed rgba(153, 0, 0, 0.1);
            position: relative;
        }

        .date-range-group::before {
            content: 'üìÖ';
            position: absolute;
            top: -10px;
            left: 20px;
            background: white;
            padding: 0 10px;
            font-size: 16px;
        }

        .date-input-wrapper {
            display: flex;
            flex-direction: column;
            gap: 8px;
            flex: 1;
        }

        .date-input-wrapper label {
            color: #990000;
            font-weight: 600;
        }

        .clear-dates-btn {
            padding: 12px 18px;
            background: linear-gradient(45deg, #6c757d, #495057);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            height: fit-content;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(108, 117, 125, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .clear-dates-btn:hover {
            background: linear-gradient(45deg, #5a6268, #343a40);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(108, 117, 125, 0.4);
        }

        .filter-reset-all {
            grid-column: span 1;
            align-self: end;
        }

        .reset-all-btn {
            padding: 12px 20px;
            background: linear-gradient(45deg, #dc3545, #c82333);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            width: 100%;
            justify-content: center;
        }

        .reset-all-btn:hover {
            background: linear-gradient(45deg, #c82333, #bd2130);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
        }

        .filter-active-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            background: linear-gradient(45deg, #990000, #ff6b6b);
            border-radius: 50%;
            margin-left: 8px;
            animation: pulse 2s infinite;
            box-shadow: 0 0 10px rgba(153, 0, 0, 0.5);
        }

        @keyframes pulse {
            0% {
                opacity: 1;
                transform: scale(1);
                box-shadow: 0 0 10px rgba(153, 0, 0, 0.5);
            }

            50% {
                opacity: 0.7;
                transform: scale(1.1);
                box-shadow: 0 0 20px rgba(153, 0, 0, 0.8);
            }

            100% {
                opacity: 1;
                transform: scale(1);
                box-shadow: 0 0 10px rgba(153, 0, 0, 0.5);
            }
        }

        .filter-count-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: linear-gradient(45deg, #990000, #cc0000);
            color: white;
            font-size: 10px;
            font-weight: 700;
            padding: 4px 8px;
            border-radius: 12px;
            min-width: 20px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(153, 0, 0, 0.3);
            animation: bounceIn 0.5s;
        }

        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3);
            }

            50% {
                opacity: 1;
                transform: scale(1.05);
            }

            70% {
                transform: scale(0.9);
            }

            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        .table-container {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #f0f0f0;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            color: #555;
        }

        .product-info {
            display: flex;
            gap: 15px;
            align-items: flex-start;
        }

        .product-image-cell {
            width: 80px;
            height: 80px;
            flex-shrink: 0;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            background: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .product-image-cell img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
        }

        .product-image-cell:hover img {
            transform: scale(1.05);
        }

        .no-image-placeholder {
            color: #999;
            font-size: 24px;
        }

        .multiple-images-indicator {
            position: absolute;
            top: 4px;
            right: 4px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 8px;
            font-weight: 600;
        }

        .product-details {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .product-name {
            font-weight: 600;
            color: #333;
            font-size: 16px;
        }

        .product-description {
            font-size: 13px;
            color: #666;
        }

        .product-dimensions {
            font-size: 12px;
            color: #007bff;
            background: #f0f8ff;
            padding: 2px 6px;
            border-radius: 4px;
            margin-top: 4px;
            display: inline-block;
        }

        .product-code {
            font-family: 'Courier New', monospace;
            font-weight: 600;
            color: #007bff;
            font-size: 14px;
            background: #f0f8ff;
            padding: 4px 8px;
            border-radius: 4px;
            display: inline-block;
        }

        .lot-badge {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
        }

        .stock-info {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .stock-number {
            font-size: 18px;
            font-weight: 700;
            color: #333;
        }

        .stock-status {
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: 600;
        }

        .stock-status.high {
            background: #d4edda;
            color: #155724;
        }

        .stock-status.medium {
            background: #fff3cd;
            color: #856404;
        }

        .stock-status.low {
            background: #f8d7da;
            color: #721c24;
        }

        .date-info {
            font-size: 14px;
            color: #666;
        }

        .supplier-info {
            font-size: 14px;
            color: #333;
            font-weight: 500;
            max-width: 200px;
            word-wrap: break-word;
        }

        .actions {
            display: flex;
            gap: 8px;
        }

        .actions button {
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .actions button:hover {
            transform: translateY(-2px);
        }

        .edit-btn {
            background: linear-gradient(45deg, #ffc107, #ffb300);
            color: white;
        }

        .edit-btn:hover {
            box-shadow: 0 4px 12px rgba(255, 193, 7, 0.4);
        }

        .delete-btn {
            background: linear-gradient(45deg, #dc3545, #c82333);
            color: white;
        }

        .delete-btn:hover {
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.4);
        }

        .view-btn {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
        }

        .view-btn:hover {
            box-shadow: 0 4px 12px rgba(40, 167, 69, 0.4);
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
            padding: 20px;
        }

        .pagination button {
            padding: 8px 12px;
            border: 2px solid #e9ecef;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pagination button:hover,
        .pagination button.active {
            background: #990000;
            color: white;
            border-color: #990000;
        }

        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translate(-50%, -60%);
            }

            to {
                opacity: 1;
                transform: translate(-50%, -50%);
            }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }

        .modal-header h2 {
            color: #333;
            font-size: 24px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #666;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: #f0f0f0;
            color: #333;
            transform: rotate(90deg);
        }

        /* Product View Modal Specific Styles */
        .product-view-modal {
            max-width: 1200px;
        }

        .product-view-content {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .product-view-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 15px;
            border-left: 5px solid #990000;
        }

        .product-view-code {
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'Courier New', monospace;
            font-size: 18px;
            font-weight: 700;
            color: #333;
        }

        .product-view-code i {
            color: #990000;
            font-size: 24px;
        }

        .category-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .category-badge[data-category="rebar"] {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
            color: white;
        }

        .category-badge[data-category="steelplate"] {
            background: linear-gradient(45deg, #34495e, #2c3e50);
            color: white;
        }

        .category-badge[data-category="structuralsteel"] {
            background: linear-gradient(45deg, #f39c12, #d68910);
            color: white;
        }

        .category-badge[data-category="wiremesh"] {
            background: linear-gradient(45deg, #27ae60, #229954);
            color: white;
        }

        .category-badge[data-category="steelproducts"] {
            background: linear-gradient(45deg, #8e44ad, #7d3c98);
            color: white;
        }

        .product-view-main {
            display: grid;
            grid-template-columns: 1fr 1.5fr;
            gap: 30px;
            align-items: start;
        }

        .product-view-images {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 20px;
            position: sticky;
            top: 20px;
        }

        .main-image-container {
            width: 100%;
            height: 300px;
            border-radius: 12px;
            overflow: hidden;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            margin-bottom: 15px;
            position: relative;
        }

        .main-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .main-image-container img:hover {
            transform: scale(1.05);
        }

        .main-image-container .no-image-placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            color: #999;
            font-size: 16px;
        }

        .main-image-container .no-image-placeholder i {
            font-size: 48px;
        }

        .thumbnail-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 10px;
            max-height: 200px;
            overflow-y: auto;
        }

        .thumbnail {
            width: 60px;
            height: 60px;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            background: white;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .thumbnail:hover,
        .thumbnail.active {
            border-color: #990000;
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(153, 0, 0, 0.3);
        }

        .thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .product-view-details {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .product-view-details h3 {
            font-size: 28px;
            color: #333;
            font-weight: 700;
            line-height: 1.3;
            margin-bottom: 5px;
        }

        .product-description-text {
            font-size: 16px;
            color: #666;
            line-height: 1.6;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #990000;
        }

        .product-view-specs {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .spec-item {
            background: white;
            border: 2px solid #f0f0f0;
            border-radius: 12px;
            padding: 15px;
            transition: all 0.3s ease;
        }

        .spec-item:hover {
            border-color: #990000;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .spec-item label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            font-weight: 600;
            color: #666;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .spec-item label i {
            color: #990000;
            width: 20px;
            text-align: center;
        }

        .spec-item span {
            font-size: 18px;
            font-weight: 700;
            color: #333;
            display: block;
        }

        .lot-value {
            background: linear-gradient(45deg, #007bff, #0056b3);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px !important;
            font-weight: 600 !important;
            display: inline-block !important;
        }

        .stock-value {
            color: #28a745;
        }

        .price-value {
            color: #990000;
        }

        .date-value {
            color: #6c757d;
        }

        .supplier-value {
            color: #333;
            font-weight: 600;
        }

        .product-view-dimensions {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #e9ecef;
        }

        .product-view-dimensions h4 {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 18px;
            color: #333;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .product-view-dimensions h4 i {
            color: #990000;
            font-size: 20px;
        }

        .dimensions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .dimension-item {
            background: white;
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #f0f0f0;
            text-align: center;
            transition: all 0.3s ease;
        }

        .dimension-item:hover {
            border-color: #990000;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .dimension-item .dimension-label {
            font-size: 12px;
            color: #666;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .dimension-item .dimension-value {
            font-size: 20px;
            font-weight: 700;
            color: #333;
        }

        .dimension-item .dimension-unit {
            font-size: 14px;
            color: #999;
            margin-left: 5px;
        }

        .product-view-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
            padding-top: 20px;
            border-top: 2px solid #f0f0f0;
        }

        .action-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }

        .edit-action-btn {
            background: linear-gradient(45deg, #ffc107, #ffb300);
            color: white;
        }

        .edit-action-btn:hover {
            box-shadow: 0 8px 25px rgba(255, 193, 7, 0.4);
        }

        .delete-action-btn {
            background: linear-gradient(45deg, #dc3545, #c82333);
            color: white;
        }

        .delete-action-btn:hover {
            box-shadow: 0 8px 25px rgba(220, 53, 69, 0.4);
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-grid-full {
            grid-column: 1 / -1;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #990000;
        }

        /* Image Upload Section */
        .images-section {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            border: 2px dashed #dee2e6;
            transition: all 0.3s ease;
        }

        .images-section.drag-over {
            border-color: #990000;
            background: linear-gradient(135deg, #fff5f5 0%, #ffe6e6 100%);
            transform: scale(1.02);
        }

        .images-section h3 {
            color: #333;
            font-size: 18px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .drop-zone {
            border: 2px dashed #ced4da;
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            background: white;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .drop-zone.drag-over {
            border-color: #990000;
            background: linear-gradient(135deg, #fff5f5 0%, #ffe6e6 100%);
            transform: scale(1.02);
        }

        .drop-zone-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        .drop-zone-icon {
            font-size: 48px;
            color: #990000;
            opacity: 0.7;
            transition: all 0.3s ease;
        }

        .drop-zone.drag-over .drop-zone-icon {
            transform: scale(1.2);
            opacity: 1;
        }

        .drop-zone-text {
            font-size: 16px;
            color: #666;
            font-weight: 500;
        }

        .drop-zone-subtext {
            font-size: 14px;
            color: #999;
        }

        .file-input {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        .upload-button {
            padding: 12px 24px;
            background: linear-gradient(45deg, #990000, #cc0000);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .upload-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(153, 0, 0, 0.3);
        }

        .image-preview-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
            max-height: 300px;
            overflow-y: auto;
            padding: 10px;
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
        }

        .image-preview {
            position: relative;
            width: 120px;
            height: 120px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .image-preview:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .image-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .image-preview-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .image-preview:hover .image-preview-overlay {
            opacity: 1;
        }

        .preview-action-btn {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .preview-view-btn {
            background: #007bff;
            color: white;
        }

        .preview-delete-btn {
            background: #dc3545;
            color: white;
        }

        .preview-action-btn:hover {
            transform: scale(1.1);
        }

        .main-image-indicator {
            position: absolute;
            top: 8px;
            left: 8px;
            background: linear-gradient(45deg, #ffc107, #ffb300);
            color: white;
            font-size: 10px;
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .image-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #999;
        }

        .dimensions-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .dimensions-section h3 {
            color: #333;
            font-size: 16px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .dimension-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
        }

        .form-actions button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .save-btn {
            background: #990000;
            color: white;
        }

        .cancel-btn {
            background: #6c757d;
            color: white;
        }

        /* Image Gallery Modal */
        .image-gallery-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 3000;
        }

        .gallery-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            text-align: center;
        }

        .gallery-image {
            max-width: 100%;
            max-height: 70vh;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
        }

        .gallery-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            color: white;
        }

        .gallery-nav-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 15px 20px;
            border-radius: 50px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .gallery-nav-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .gallery-nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .gallery-close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 24px;
            transition: all 0.3s ease;
        }

        .gallery-close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        .gallery-info {
            color: white;
            font-size: 14px;
        }

        /* Sidebar Styles */
        .sidebar {
            background: #940606;
            color: white;
            width: 260px;
            min-width: 260px;
            height: 100%;
            position: fixed;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.1);
        }

        .sidebar.collapsed {
            width: 0;
            min-width: 0;
            overflow: hidden;
        }

        .logo {
            padding: 30px 20px;
            text-align: center;
            border-bottom: 1px solid #940606;
            font-size: 18px;
            font-weight: 600;
            margin-top: 10px;
        }

        nav ul {
            list-style: none;
            padding: 20px 0;
        }

        nav li {
            margin: 5px 0;
            transition: all 0.3s ease;
        }

        nav li a {
            display: flex;
            align-items: center;
            padding: 15px 25px;
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }

        nav li a i {
            margin-right: 12px;
            width: 20px;
            text-align: center;
        }

        nav li.active a,
        nav li a:hover {
            background: #051A37;
        }

        @media screen and (max-width: 768px) {
            .navbar-toggle {
                display: block;
            }

            .main-content {
                padding: 80px 20px 20px;
                margin-left: 0;
            }

            .header {
                flex-direction: column;
                gap: 15px;
            }

            .search-container input[type="text"] {
                width: 100%;
            }

            .filters-row {
                grid-template-columns: 1fr;
            }

            .date-range-group {
                grid-column: span 1;
                flex-direction: column;
                align-items: stretch;
            }

            .filter-group {
                min-width: auto;
            }

            table {
                font-size: 14px;
            }

            th,
            td {
                padding: 10px 8px;
            }

            .actions {
                flex-direction: column;
            }

            .sidebar {
                position: fixed;
                top: 0;
                left: -260px;
                height: 100vh;
                z-index: 1000;
            }

            .sidebar.show {
                left: 0;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .dimension-row {
                grid-template-columns: 1fr;
            }

            .image-preview-container {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            }

            .image-preview {
                width: 80px;
                height: 80px;
            }

            .product-view-main {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .product-view-specs {
                grid-template-columns: 1fr;
            }

            .dimensions-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }

            .product-view-actions {
                flex-direction: column;
            }
        }

        @media screen and (max-width: 480px) {
            .actions button {
                font-size: 12px;
                padding: 6px 8px;
            }
        }
    </style>
</head>

<body>
    <div class="navbar-toggle" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </div>

    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="logo">
                <div>
                    <img src="image_admin/logo_cropped.png" width="100px">
                </div>
                <h2>‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</h2>
            </div>

            <nav>
                <ul>
                    <li>
                        <a href="dashboard_admin.html" onclick="showSection('dashboard')">
                            <i class="fas fa-tachometer-alt"></i>
                            ‡πÅ‡∏î‡∏ä‡∏ö‡∏≠‡∏£‡πå‡∏î
                        </a>
                    </li>
                    <li class="active">
                        <a href="products_admin.html" onclick="showSection('products')">
                            <i class="fas fa-box"></i>
                            ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                        </a>
                    </li>
                    <li>
                        <a href="orders_admin.html" onclick="showSection('orders')">
                            <i class="fas fa-shopping-cart"></i>
                            ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠
                        </a>
                    </li>
                    <li>
                        <a href="admins_admin.html" onclick="showSection('admins')">
                            <i class="fas fa-users-cog"></i>
                            ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•
                        </a>
                    </li>
                    <li>
                        <a href="reports_admin.html" onclick="showSection('reports')">
                            <i class="fas fa-chart-bar"></i>
                            ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <main class="main-content">
            <div class="header">
                <h1><i class="fas fa-box"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h1>
                <div class="search-add">
                    <div class="search-container">
                        <input type="text" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤, ‡∏•‡πá‡∏≠‡∏ï ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤...">
                        <i class="fas fa-search"></i>
                    </div>
                    <button class="add-btn" onclick="openAddModal()">
                        <i class="fas fa-plus"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                    </button>
                </div>
            </div>

            <div class="stats-row">
                <div class="stat-card">
                    <div class="stat-number" id="totalProducts">0</div>
                    <div class="stat-label">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="lowStockProducts">0</div>
                    <div class="stat-label">‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="filteredProducts">0</div>
                    <div class="stat-label">‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</div>
                </div>
            </div>

            <div class="filters-section">
                <div class="filters-header">
                    <i class="fas fa-filter"></i>
                    <h3>‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h3>
                    <div id="activeFiltersCount" class="filter-count-badge" style="display: none;">0</div>
                </div>
                <div class="filters-row">
                    <div class="filter-group">
                        <label><i class="fas fa-tags"></i> ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                        <select id="categoryFilter">
                            <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                            <option value="rebar">‡πÄ‡∏´‡∏•‡πá‡∏Å‡πÄ‡∏™‡πâ‡∏ô</option>
                            <option value="steelplate">‡πÄ‡∏´‡∏•‡πá‡∏Å‡πÅ‡∏ú‡πà‡∏ô</option>
                            <option value="structuralsteel">‡πÄ‡∏´‡∏•‡πá‡∏Å‡∏£‡∏π‡∏õ‡∏û‡∏£‡∏£‡∏ì</option>
                            <option value="wiremesh">‡πÄ‡∏´‡∏•‡πá‡∏Å‡∏ï‡∏∞‡πÅ‡∏Å‡∏£‡∏á/‡∏ï‡∏≤‡∏Ç‡πà‡∏≤‡∏¢</option>
                            <option value="steelproducts">‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label><i class="fas fa-warehouse"></i> ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏ï‡πá‡∏≠‡∏Å</label>
                        <select id="stockFilter">
                            <option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                            <option value="high">‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠</option>
                            <option value="medium">‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á</option>
                            <option value="low">‡∏™‡∏ï‡πá‡∏≠‡∏Å‡∏ï‡πà‡∏≥</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label><i class="fas fa-sort"></i> ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°</label>
                        <select id="sortFilter">
                            <option value="name">‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</option>
                            <option value="stock">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</option>
                            <option value="lot">‡∏•‡πá‡∏≠‡∏ï</option>
                            <option value="receivedDate_desc">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤ (‡πÉ‡∏´‡∏°‡πà-‡πÄ‡∏Å‡πà‡∏≤)</option>
                            <option value="receivedDate_asc">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤ (‡πÄ‡∏Å‡πà‡∏≤-‡πÉ‡∏´‡∏°‡πà)</option>
                            <option value="supplier">‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå</option>
                        </select>
                    </div>
                    <div class="date-range-group">
                        <div class="date-input-wrapper">
                            <label><i class="fas fa-calendar-alt"></i> ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤ ‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà</label>
                            <input type="date" id="startDateFilter">
                        </div>
                        <div class="date-input-wrapper">
                            <label><i class="fas fa-calendar-check"></i> ‡∏ñ‡∏∂‡∏á</label>
                            <input type="date" id="endDateFilter">
                        </div>
                        <button class="clear-dates-btn" onclick="clearDateFilters()">
                            <i class="fas fa-times"></i>
                            ‡∏•‡πâ‡∏≤‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
                        </button>
                    </div>
                    <div class="filter-reset-all">
                        <button class="reset-all-btn" onclick="resetAllFilters()">
                            <i class="fas fa-undo"></i>
                            ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                        </button>
                    </div>
                </div>
            </div>

            <div class="table-container">
                <table id="productsTable">
                    <thead>
                        <tr>
                            <th>‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                            <th>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</th>
                            <th>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</th>
                            <th>‡∏•‡πá‡∏≠‡∏ï</th>
                            <th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
                            <th>‡∏£‡∏≤‡∏Ñ‡∏≤</th>
                            <th>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤</th>
                            <th>‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå</th>
                            <th>‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                        </tr>

                    </thead>
                    <tbody id="productsTableBody">
                        <!-- Product rows will be dynamically inserted here -->
                    </tbody>
                </table>
            </div>

            <div class="pagination" id="pagination">
                <!-- Pagination buttons will be inserted here -->
            </div>
        </main>
    </div>

    <!-- Add/Edit Product Modal -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <form id="productForm">
                <div class="form-grid">
                    <!-- ‡∏•‡∏ö field ‡∏£‡∏´‡∏±‡∏™‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏≠‡∏≠‡∏Å -->
                    <div class="form-group">
                        <label>‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà *</label>
                        <select id="productCategory" required>
                            <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>
                            <option value="rebar">‡πÄ‡∏´‡∏•‡πá‡∏Å‡πÄ‡∏™‡πâ‡∏ô</option>
                            <option value="steelplate">‡πÄ‡∏´‡∏•‡πá‡∏Å‡πÅ‡∏ú‡πà‡∏ô</option>
                            <option value="structuralsteel">‡πÄ‡∏´‡∏•‡πá‡∏Å‡∏£‡∏π‡∏õ‡∏û‡∏£‡∏£‡∏ì</option>
                            <option value="wiremesh">‡πÄ‡∏´‡∏•‡πá‡∏Å‡∏ï‡∏∞‡πÅ‡∏Å‡∏£‡∏á/‡∏ï‡∏≤‡∏Ç‡πà‡∏≤‡∏¢</option>
                            <option value="steelproducts">‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</option>
                        </select>
                    </div>
                </div>

                <div class="form-group form-grid-full">
                    <label>‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ *</label>
                    <input type="text" id="productName" required>
                </div>

                <div class="form-group">
                    <label>‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢</label>
                    <textarea id="productDescription" rows="3"></textarea>
                </div>

                <!-- Image Upload Section ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° -->
                <div class="images-section" id="imagesSection">
                    <h3><i class="fas fa-images"></i> ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h3>

                    <div class="drop-zone" id="dropZone">
                        <input type="file" id="imageInput" class="file-input" multiple accept="image/*">
                        <div class="drop-zone-content">
                            <i class="fas fa-cloud-upload-alt drop-zone-icon"></i>
                            <div class="drop-zone-text">‡∏•‡∏≤‡∏Å‡πÅ‡∏•‡∏∞‡∏ß‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà</div>
                            <div class="drop-zone-subtext">‡∏´‡∏£‡∏∑‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå (‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ‡∏´‡∏•‡∏≤‡∏¢‡πÑ‡∏ü‡∏•‡πå)</div>
                            <button type="button" class="upload-button"
                                onclick="document.getElementById('imageInput').click()">
                                <i class="fas fa-plus"></i>
                                ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
                            </button>
                        </div>
                    </div>

                    <div class="image-preview-container" id="imagePreviewContainer">
                        <!-- Image previews will be inserted here -->
                    </div>
                </div>

                <!-- Dimensions Section ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° -->
                <div class="dimensions-section">
                    <h3><i class="fas fa-ruler-combined"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å</h3>

                    <div class="dimension-row">
                        <div class="form-group">
                            <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á</label>
                            <input type="number" id="productWidth" step="0.01" min="0" placeholder="0.00">
                        </div>
                        <div class="form-group">
                            <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢</label>
                            <select id="widthUnit">
                                <option value="mm">‡∏°‡∏°.</option>
                                <option value="cm">‡∏ã‡∏°.</option>
                                <option value="m">‡∏°.</option>
                                <option value="inch">‡∏ô‡∏¥‡πâ‡∏ß</option>
                            </select>
                        </div>
                    </div>

                    <div class="dimension-row">
                        <div class="form-group">
                            <label>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß</label>
                            <input type="number" id="productLength" step="0.01" min="0" placeholder="0.00">
                        </div>
                        <div class="form-group">
                            <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢</label>
                            <select id="lengthUnit">
                                <option value="mm">‡∏°‡∏°.</option>
                                <option value="cm">‡∏ã‡∏°.</option>
                                <option value="m">‡∏°.</option>
                                <option value="inch">‡∏ô‡∏¥‡πâ‡∏ß</option>
                            </select>
                        </div>
                    </div>

                    <div class="dimension-row">
                        <div class="form-group">
                            <label>‡∏™‡πà‡∏ß‡∏ô‡∏™‡∏π‡∏á/‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤</label>
                            <input type="number" id="productHeight" step="0.01" min="0" placeholder="0.00">
                        </div>
                        <div class="form-group">
                            <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢</label>
                            <select id="heightUnit">
                                <option value="mm">‡∏°‡∏°.</option>
                                <option value="cm">‡∏ã‡∏°.</option>
                                <option value="m">‡∏°.</option>
                                <option value="inch">‡∏ô‡∏¥‡πâ‡∏ß</option>
                            </select>
                        </div>
                    </div>

                    <div class="dimension-row">
                        <div class="form-group">
                            <label>‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å</label>
                            <input type="number" id="productWeight" step="0.01" min="0" placeholder="0.00">
                        </div>
                        <div class="form-group">
                            <label>‡∏´‡∏ô‡πà‡∏ß‡∏¢</label>
                            <select id="weightUnit">
                                <option value="kg">‡∏Å‡∏Å.</option>
                                <option value="g">‡∏Å‡∏£‡∏±‡∏°</option>
                                <option value="ton">‡∏ï‡∏±‡∏ô</option>
                                <option value="lb">‡∏õ‡∏≠‡∏ô‡∏î‡πå</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>‡∏•‡πá‡∏≠‡∏ï *</label>
                        <input type="text" id="productLot" required>
                    </div>
                    <div class="form-group">
                        <label>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠ *</label>
                        <input type="number" id="productStock" required min="0">
                    </div>
                </div>

                <div class="form-grid">
                    <div class="form-group">
                        <label>‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢ (‡∏ö‡∏≤‡∏ó)</label>
                        <input type="number" id="productPrice" step="0.01" min="0">
                    </div>
                    <div class="form-group">
                        <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤ *</label>
                        <input type="date" id="productReceivedDate" required>
                    </div>
                </div>

                <!-- ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà field ‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏¥‡∏° -->
                <div class="form-group">
                    <label>‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå *</label>
                    <select id="productSupplier" required>
                        <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå</option>
                        <option value="‡∏ö‡∏à‡∏Å. ‡πÇ‡∏≠‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ô‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå ‡∏à‡∏≥‡∏Å‡∏±‡∏î (Ocean Supplier)">‡∏ö‡∏à‡∏Å. ‡πÇ‡∏≠‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ô‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå ‡∏à‡∏≥‡∏Å‡∏±‡∏î
                            (Ocean Supplier)</option>
                        <option value="Metallic Corporation Limited (MCC / Metallic Steel Center)">Metallic Corporation
                            Limited (MCC / Metallic Steel Center)</option>
                        <option value="Millcon Steel (MILL)">Millcon Steel (MILL)</option>
                        <option value="Navasiam Steel Co., Ltd.">Navasiam Steel Co., Ltd.</option>
                        <option value="‡∏Å‡∏¥‡∏à‡πÑ‡∏û‡∏ö‡∏π‡∏•‡∏¢‡πå ‡πÄ‡∏°‡πá‡∏ó‡∏ó‡∏≠‡∏•">‡∏Å‡∏¥‡∏à‡πÑ‡∏û‡∏ö‡∏π‡∏•‡∏¢‡πå ‡πÄ‡∏°‡πá‡∏ó‡∏ó‡∏≠‡∏•</option>
                        <option value="Chuephaibul Steel (‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÑ‡∏û‡∏ö‡∏π‡∏•‡∏¢‡πå ‡∏™‡∏ï‡∏µ‡∏•)">Chuephaibul Steel (‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÑ‡∏û‡∏ö‡∏π‡∏•‡∏¢‡πå ‡∏™‡∏ï‡∏µ‡∏•)
                        </option>
                    </select>
                </div>

                <div class="form-actions">
                    <button type="button" class="cancel-btn" onclick="closeModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                    <button type="submit" class="save-btn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Product View Modal -->
    <div id="productViewModal" class="modal">
        <div class="modal-content product-view-modal">
            <div class="modal-header">
                <h2 id="viewModalTitle"><i class="fas fa-eye"></i> ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤</h2>
                <button class="close-btn" onclick="closeViewModal()">&times;</button>
            </div>

            <div class="product-view-content">
                <!-- Product Header -->
                <div class="product-view-header">
                    <div class="product-view-code">
                        <i class="fas fa-barcode"></i>
                        <span id="viewProductCode">-</span>
                    </div>
                    <div class="product-view-category">
                        <span id="viewProductCategory" class="category-badge">-</span>
                    </div>
                </div>

                <!-- Product Main Info -->
                <div class="product-view-main">
                    <div class="product-view-images">
                        <div class="main-image-container" id="viewMainImageContainer">
                            <div class="no-image-placeholder">
                                <i class="fas fa-image"></i>
                                <span>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</span>
                            </div>
                        </div>
                        <div class="thumbnail-gallery" id="viewThumbnailGallery">
                            <!-- Thumbnails will be inserted here -->
                        </div>
                    </div>

                    <div class="product-view-details">
                        <h3 id="viewProductName">-</h3>
                        <p id="viewProductDescription" class="product-description-text">-</p>

                        <div class="product-view-specs">
                            <div class="spec-item">
                                <label><i class="fas fa-layer-group"></i> ‡∏•‡πá‡∏≠‡∏ï:</label>
                                <span id="viewProductLot" class="lot-value">-</span>
                            </div>
                            <div class="spec-item">
                                <label><i class="fas fa-warehouse"></i> ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠:</label>
                                <span id="viewProductStock" class="stock-value">-</span>
                            </div>
                            <div class="spec-item">
                                <label><i class="fas fa-tag"></i> ‡∏£‡∏≤‡∏Ñ‡∏≤‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πà‡∏ß‡∏¢:</label>
                                <span id="viewProductPrice" class="price-value">-</span>
                            </div>
                            <div class="spec-item">
                                <label><i class="fas fa-calendar-alt"></i> ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏£‡∏±‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤:</label>
                                <span id="viewProductDate" class="date-value">-</span>
                            </div>
                            <div class="spec-item">
                                <label><i class="fas fa-truck"></i> ‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå:</label>
                                <span id="viewProductSupplier" class="supplier-value">-</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dimensions Section -->
                <div class="product-view-dimensions" id="viewDimensionsSection">
                    <h4><i class="fas fa-ruler-combined"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏ô‡∏≤‡∏î‡πÅ‡∏•‡∏∞‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å</h4>
                    <div class="dimensions-grid" id="viewDimensionsGrid">
                        <!-- Dimensions will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Gallery Modal -->
    <div id="imageGalleryModal" class="image-gallery-modal">
        <div class="gallery-content">
            <button class="gallery-close-btn" onclick="closeImageGallery()">&times;</button>
            <img id="galleryImage" class="gallery-image" src="" alt="">
            <div class="gallery-controls">
                <button class="gallery-nav-btn" id="prevImageBtn" onclick="navigateImage(-1)">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div class="gallery-info">
                    <span id="currentImageIndex">1</span> / <span id="totalImages">1</span>
                </div>
                <button class="gallery-nav-btn" id="nextImageBtn" onclick="navigateImage(1)">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>

    <script>
        // Sample product data - will be replaced by database data
        let products = [];
        let categories = [];
        let suppliers = [];
        let currentPage = 1;
        const itemsPerPage = 10;
        let filteredProducts = [...products];
        let currentEditId = null;
        let currentViewId = null;
        let productImages = [];
        let currentGalleryImages = [];
        let currentImageIndex = 0;

        // API endpoints
        const API_BASE = 'http://localhost/steelproject/admin/';
        const ENDPOINTS = {
            products: API_BASE + 'get_products.php',
            addProduct: API_BASE + 'add_product.php',
            manageProduct: API_BASE + 'manage_product.php',
            uploadImage: API_BASE + 'upload_image.php'
        };

        // Load initial data when page loads
        async function loadInitialData() {
            try {
                await Promise.all([
                    loadProducts(),
                    loadCategories(),
                    loadSuppliers()
                ]);
                renderProducts();
            } catch (error) {
                console.error('Error loading initial data:', error);
                showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
            }
        }

        // Load products from API with improved data structure handling
        async function loadProducts() {
            try {
                const response = await fetch(ENDPOINTS.products);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const result = await response.json();
                console.log('Products API Response:', result);

                if (result.success && result.data) {
                    // ‡∏à‡∏±‡∏î‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ï‡∏≤‡∏° product_id ‡πÅ‡∏•‡∏∞‡∏£‡∏ß‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
                    const productMap = new Map();

                    result.data.forEach(product => {
                        const productId = product.product_id;

                        if (!productMap.has(productId)) {
                            productMap.set(productId, {
                                id: productId,
                                productCode: productId,
                                name: product.name || '',
                                description: product.description || '',
                                category: product.category_id || '',
                                categoryName: product.category_name || '',
                                lot: product.lot || '',
                                stock: Number(product.stock) || 0,
                                price: Number(product.price) || 0,
                                receivedDate: product.received_date
                                    ? new Date(product.received_date).toISOString().split('T')[0]
                                    : null,
                                supplier: product.supplier_id || '',
                                supplierName: product.supplier_name || '',
                                dimensions: {
                                    width: {
                                        value: Number(product.width) || 0,
                                        unit: product.width_unit || 'mm'
                                    },
                                    length: {
                                        value: Number(product.length) || 0,
                                        unit: product.length_unit || 'mm'
                                    },
                                    height: {
                                        value: Number(product.height) || 0,
                                        unit: product.height_unit || 'mm'
                                    },
                                    weight: {
                                        value: Number(product.weight) || 0,
                                        unit: product.weight_unit || 'kg'
                                    }
                                },
                                images: []
                            });
                        }

                        // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏à‡∏≤‡∏Å product.images array
                        if (product.images && Array.isArray(product.images)) {
                            const existingProduct = productMap.get(productId);
                            product.images.forEach(img => {
                                if (img.image_url && !existingProduct.images.some(existing => existing === img.image_url)) {
                                    if (img.is_main) {
                                        existingProduct.images.unshift(img.image_url);
                                    } else {
                                        existingProduct.images.push(img.image_url);
                                    }
                                }
                            });
                        }
                    });

                    products = Array.from(productMap.values());
                    filteredProducts = [...products];
                    console.log('Processed products:', products);
                } else {
                    console.warn('Invalid products response:', result);
                    products = [];
                    filteredProducts = [];
                }

            } catch (error) {
                console.error('Error loading products:', error);
                showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: ' + error.message, 'error');
                throw error;
            }
        }

        // Load categories (hardcoded data)
        async function loadCategories() {
            categories = [
                { id: 'rb', name: '‡πÄ‡∏´‡∏•‡πá‡∏Å‡πÄ‡∏™‡πâ‡∏ô' },
                { id: 'sp', name: '‡πÄ‡∏´‡∏•‡πá‡∏Å‡πÅ‡∏ú‡πà‡∏ô' },
                { id: 'ss', name: '‡πÄ‡∏´‡∏•‡πá‡∏Å‡∏£‡∏π‡∏õ‡∏û‡∏£‡∏£‡∏ì' },
                { id: 'wm', name: '‡πÄ‡∏´‡∏•‡πá‡∏Å‡∏ï‡∏∞‡πÅ‡∏Å‡∏£‡∏á/‡∏ï‡∏≤‡∏Ç‡πà‡∏≤‡∏¢' },
                { id: 'ot', name: '‡∏≠‡∏∑‡πà‡∏ô ‡πÜ' }
            ];
            populateCategoryDropdown();
        }

        // Load suppliers (hardcoded data)
        async function loadSuppliers() {
            suppliers = [
                { id: 'SUP01', name: '‡∏ö‡∏à‡∏Å. ‡πÇ‡∏≠‡πÄ‡∏ä‡∏µ‡∏¢‡∏ô‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå ‡∏à‡∏≥‡∏Å‡∏±‡∏î (Ocean Supplier)' },
                { id: 'SUP02', name: 'Metallic Corporation Limited (MCC / Metallic Steel Center)' },
                { id: 'SUP03', name: 'Millcon Steel (MILL)' },
                { id: 'SUP04', name: 'Navasiam Steel Co., Ltd.' },
                { id: 'SUP05', name: '‡∏Å‡∏¥‡∏à‡πÑ‡∏û‡∏ö‡∏π‡∏•‡∏¢‡πå ‡πÄ‡∏°‡∏ó‡∏ó‡∏≠‡∏•' },
                { id: 'SUP06', name: 'Chuephaibul Steel (‡πÄ‡∏ä‡∏∑‡πâ‡∏≠‡πÑ‡∏û‡∏ö‡∏π‡∏•‡∏¢‡πå ‡∏™‡∏ï‡∏µ‡∏•)' }
            ];
            populateSupplierDropdown();
        }

        // Populate category dropdown
        function populateCategoryDropdown() {
            const categorySelect = document.getElementById('productCategory');
            const categoryFilter = document.getElementById('categoryFilter');

            if (categorySelect) {
                categorySelect.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>';
                categories.forEach(category => {
                    categorySelect.innerHTML += `<option value="${category.id}">${category.name}</option>`;
                });
            }

            if (categoryFilter) {
                categoryFilter.innerHTML = '<option value="">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>';
                categories.forEach(category => {
                    categoryFilter.innerHTML += `<option value="${category.id}">${category.name}</option>`;
                });
            }
        }

        // Populate supplier dropdown
        function populateSupplierDropdown() {
            const supplierSelect = document.getElementById('productSupplier');
            if (supplierSelect) {
                supplierSelect.innerHTML = '<option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå</option>';
                suppliers.forEach(supplier => {
                    supplierSelect.innerHTML += `<option value="${supplier.id}">${supplier.name}</option>`;
                });
            }
        }

        // Get category name in Thai
        function getCategoryName(categoryId) {
            const category = categories.find(cat => cat.id === categoryId);
            return category ? category.name : categoryId;
        }

        // Get supplier name
        function getSupplierName(supplierId) {
            const supplier = suppliers.find(sup => sup.id === supplierId);
            return supplier ? supplier.name : supplierId;
        }

        // Enhanced image handling
        async function handleImageFiles(files) {
            const validExtensions = ['jpg', 'jpeg', 'png', 'webp', 'gif'];
            const tasks = [];

            for (const file of files) {
                const ext = file.name.split('.').pop().toLowerCase();
                if (!file.type.startsWith('image/') || !validExtensions.includes(ext)) {
                    showNotification(`‡πÑ‡∏ü‡∏•‡πå ${file.name} ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö`, 'warning');
                    continue;
                }

                if (file.size > 5 * 1024 * 1024) { // 5MB
                    showNotification(`‡πÑ‡∏ü‡∏•‡πå ${file.name} ‡∏°‡∏µ‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏Å‡∏¥‡∏ô 5MB`, 'warning');
                    continue;
                }

                try {
                    if (!currentEditId) {
                        // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà ‚Üí ‡πÄ‡∏Å‡πá‡∏ö base64
                        const reader = new FileReader();
                        reader.onload = function (e) {
                            productImages.push(e.target.result);
                            renderImagePreviews();
                        };
                        reader.readAsDataURL(file);
                    } else {
                        // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà ‚Üí ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
                        tasks.push(uploadImageFile(file, currentEditId));
                    }
                } catch (error) {
                    console.error('Error handling image:', error);
                    showNotification(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏Å‡∏±‡∏ö‡πÑ‡∏ü‡∏•‡πå ${file.name}`, 'error');
                }
            }

            // ‡∏£‡∏≠ upload ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏´‡πâ‡πÄ‡∏™‡∏£‡πá‡∏à
            if (tasks.length > 0) {
                try {
                    const results = await Promise.all(tasks);
                    const successful = results.filter(r => r.success).length;
                    const failed = results.filter(r => !r.success).length;

                    if (successful > 0) {
                        showNotification(`‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${successful} ‡∏£‡∏π‡∏õ${failed > 0 ? `, ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ${failed} ‡∏£‡∏π‡∏õ` : ''}`,
                            failed > 0 ? 'warning' : 'success');
                        // Refresh product data to show new images
                        await loadProducts();
                        if (currentEditId) {
                            const product = products.find(p => p.id === currentEditId);
                            if (product) {
                                productImages = [...(product.images || [])];
                                renderImagePreviews();
                            }
                        }
                    }
                } catch (err) {
                    showNotification('‡∏°‡∏µ‡∏ö‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'error');
                }
            }
        }

        // Validate product form
        function validateProductForm() {
            const name = getElementValue('productName');
            const categoryId = getElementValue('productCategory');
            const supplierId = getElementValue('productSupplier');

            if (!name.trim()) {
                showNotification('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤', 'error');
                return false;
            }

            // Validate category if selected
            if (categoryId && !categories.find(cat => cat.id === categoryId)) {
                showNotification('‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
                return false;
            }

            // Validate supplier if selected
            if (supplierId && !suppliers.find(sup => sup.id === supplierId)) {
                showNotification('‡∏ã‡∏±‡∏û‡∏û‡∏•‡∏≤‡∏¢‡πÄ‡∏≠‡∏≠‡∏£‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á', 'error');
                return false;
            }

            return true;
        }

        // Upload image file to server with better error handling
        async function uploadImageFile(file, productId, isMain = false) {
            const formData = new FormData();
            formData.append('image', file);
            formData.append('product_id', productId);
            formData.append('is_main', isMain ? '1' : '0');

            try {
                const response = await fetch(ENDPOINTS.uploadImage, {
                    method: 'POST',
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }

                const result = await response.json();
                console.log('Upload result:', result);

                if (result.status === 'success' && result.url) {
                    return { success: true, url: result.url, message: result.message };
                } else {
                    throw new Error(result.message || '‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß');
                }
            } catch (error) {
                console.error('Error uploading image:', error);
                return { success: false, error: error.message };
            }
        }

        // Render image previews
        function renderImagePreviews() {
            const container = document.getElementById('imagePreviewContainer');
            if (!container) return;

            container.innerHTML = '';

            productImages.forEach((image, index) => {
                const preview = document.createElement('div');
                preview.className = 'image-preview';
                preview.innerHTML = `
            <img src="${image}" alt="Product Image ${index + 1}" loading="lazy">
            ${index === 0 ? '<div class="main-image-indicator"><i class="fas fa-star"></i> ‡∏´‡∏•‡∏±‡∏Å</div>' : ''}
            <div class="image-preview-overlay">
                <button class="preview-action-btn preview-view-btn" onclick="viewImage(${index})">
                    <i class="fas fa-eye"></i>
                </button>
                <button class="preview-action-btn preview-delete-btn" onclick="removeImage(${index})">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        `;
                container.appendChild(preview);
            });
        }

        // Remove image from preview
        function removeImage(index) {
            productImages.splice(index, 1);
            renderImagePreviews();
            showNotification('‡∏•‡∏ö‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÅ‡∏•‡πâ‡∏ß', 'info');
        }

        // View image in gallery
        function viewImage(index) {
            currentGalleryImages = [...productImages];
            currentImageIndex = index;
            openImageGallery();
        }

        // Image gallery functions
        function openImageGallery() {
            const modal = document.getElementById('imageGalleryModal');
            if (!modal || currentGalleryImages.length === 0) return;

            const image = document.getElementById('galleryImage');
            const currentIndex = document.getElementById('currentImageIndex');
            const totalImages = document.getElementById('totalImages');
            const prevBtn = document.getElementById('prevImageBtn');
            const nextBtn = document.getElementById('nextImageBtn');

            if (image) image.src = currentGalleryImages[currentImageIndex];
            if (currentIndex) currentIndex.textContent = currentImageIndex + 1;
            if (totalImages) totalImages.textContent = currentGalleryImages.length;

            if (prevBtn) prevBtn.disabled = currentImageIndex === 0;
            if (nextBtn) nextBtn.disabled = currentImageIndex === currentGalleryImages.length - 1;

            modal.style.display = 'block';
        }

        function closeImageGallery() {
            const modal = document.getElementById('imageGalleryModal');
            if (modal) modal.style.display = 'none';
        }

        function navigateImage(direction) {
            const newIndex = currentImageIndex + direction;
            if (newIndex >= 0 && newIndex < currentGalleryImages.length) {
                currentImageIndex = newIndex;
                openImageGallery();
            }
        }

        // Get stock status
        function getStockStatus(stock) {
            if (stock >= 100) return { class: 'high', text: '‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠' };
            if (stock >= 50) return { class: 'medium', text: '‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á' };
            return { class: 'low', text: '‡∏ï‡πà‡∏≥' };
        }

        // Format date for display
        function formatDate(dateString) {
            if (!dateString) return '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
            const date = new Date(dateString);
            if (isNaN(date.getTime())) return '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
            return date.toLocaleDateString('th-TH', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        // Format dimensions for display
        function formatDimensions(dimensions) {
            if (!dimensions) return '';

            let parts = [];
            if (dimensions.width && dimensions.width.value) {
                parts.push(`‡∏Å‡∏ß‡πâ‡∏≤‡∏á ${dimensions.width.value} ${dimensions.width.unit}`);
            }
            if (dimensions.length && dimensions.length.value) {
                parts.push(`‡∏¢‡∏≤‡∏ß ${dimensions.length.value} ${dimensions.length.unit}`);
            }
            if (dimensions.height && dimensions.height.value) {
                parts.push(`‡∏´‡∏ô‡∏≤ ${dimensions.height.value} ${dimensions.height.unit}`);
            }
            if (dimensions.weight && dimensions.weight.value) {
                parts.push(`‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å ${dimensions.weight.value} ${dimensions.weight.unit}`);
            }

            return parts.length > 0 ? parts.join(' √ó ') : '';
        }

        // Render products table with improved error handling
        function renderProducts() {
            const tbody = document.getElementById('productsTableBody');
            if (!tbody) return;

            try {
                const startIndex = (currentPage - 1) * itemsPerPage;
                const endIndex = startIndex + itemsPerPage;
                const pageProducts = filteredProducts.slice(startIndex, endIndex);

                tbody.innerHTML = pageProducts.map(product => {
                    const stockStatus = getStockStatus(product.stock);
                    const dimensionsText = formatDimensions(product.dimensions);
                    const hasImages = product.images && product.images.length > 0;
                    const imageCount = hasImages ? product.images.length : 0;
                    const supplierName = product.supplierName || getSupplierName(product.supplier) || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                    const categoryName = product.categoryName || getCategoryName(product.category) || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';

                    return `
                <tr>
                    <td>
                        <span class="product-code">${product.productCode || product.id}</span>
                    </td>
                    <td>
                        <div class="product-info">
                            <div class="product-image-cell" ${hasImages ? `onclick="viewProductImages('${product.id}')" style="cursor: pointer;"` : ''}>
                                ${hasImages ?
                            `<img src="${product.images[0]}" alt="${product.name}" loading="lazy">
                                     ${imageCount > 1 ? `<div class="multiple-images-indicator">+${imageCount - 1}</div>` : ''}` :
                            '<i class="fas fa-image no-image-placeholder"></i>'
                        }
                            </div>
                            <div class="product-details">
                                <div class="product-name">${product.name}</div>
                                ${product.description ? `<div class="product-description">${product.description}</div>` : ''}
                                ${dimensionsText ? `<div class="product-dimensions">${dimensionsText}</div>` : ''}
                            </div>
                        </div>
                    </td>
                    <td>
                        <span class="category-badge" data-category="${product.category}">${categoryName}</span>
                    </td>
                    <td>
                        <span class="lot-badge">${product.lot || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'}</span>
                    </td>
                    <td>
                        <div class="stock-info">
                            <div class="stock-number">${product.stock} ‡∏ä‡∏¥‡πâ‡∏ô</div>
                            <span class="stock-status ${stockStatus.class}">${stockStatus.text}</span>
                        </div>
                    </td>
                    <td>
                        <div class="price-info">
                            ${product.price > 0 ? `‡∏ø${product.price.toLocaleString()}` : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏Ñ‡∏≤'}
                        </div>
                    </td>
                    <td>
                        <div class="date-info">${formatDate(product.receivedDate)}</div>
                    </td>
                    <td>
                        <div class="supplier-info" title="${supplierName}">${supplierName}</div>
                    </td>
                    <td class="actions">
                        <button class="view-btn" onclick="viewProduct('${product.id}')" title="‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="edit-btn" onclick="editProduct('${product.id}')" title="‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="delete-btn" onclick="deleteProduct('${product.id}')" title="‡∏•‡∏ö">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                </tr>
            `;
                }).join('');

                renderPagination();
                updateStats();
            } catch (error) {
                console.error('Error rendering products:', error);
                tbody.innerHTML = '<tr><td colspan="9" class="text-center">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</td></tr>';
            }
        }

        // Save product form
        function setupProductForm() {
            const productForm = document.getElementById('productForm');
            if (!productForm) return;

            productForm.addEventListener('submit', async function (e) {
                e.preventDefault();

                if (!validateProductForm()) {
                    return;
                }

                const formData = {
                    name: getElementValue('productName'),
                    description: getElementValue('productDescription'),
                    category_id: getElementValue('productCategory') || null,
                    supplier_id: getElementValue('productSupplier') || null,
                    lot: getElementValue('productLot') || '',
                    stock: parseInt(getElementValue('productStock')) || 0,
                    price: parseFloat(getElementValue('productPrice')) || 0,
                    received_date: getElementValue('productReceivedDate'),
                    width: parseFloat(getElementValue('productWidth')) || null,
                    length: parseFloat(getElementValue('productLength')) || null,
                    height: parseFloat(getElementValue('productHeight')) || null,
                    weight: parseFloat(getElementValue('productWeight')) || null,
                    width_unit: getElementValue('widthUnit') || 'mm',
                    length_unit: getElementValue('lengthUnit') || 'mm',
                    height_unit: getElementValue('heightUnit') || 'mm',
                    weight_unit: getElementValue('weightUnit') || 'kg'
                };

                try {
                    let response, result;

                    if (currentEditId) {
                        // Update existing product
                        formData.product_id = currentEditId;
                        formData._method = 'PUT';

                        console.log('Updating product with data:', formData);

                        response = await fetch(ENDPOINTS.manageProduct, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(formData)
                        });

                        console.log('Update response status:', response.status);

                        let responseText;
                        try {
                            responseText = await response.text();
                            console.log('Update raw response:', responseText);

                            if (!responseText.trim()) {
                                throw new Error('Server ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á response ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤');
                            }

                            result = JSON.parse(responseText);
                        } catch (parseError) {
                            console.error('JSON parse error:', parseError);

                            // ‡∏ñ‡πâ‡∏≤ response status ok ‡πÅ‡∏ï‡πà parse ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                            if (response.ok) {
                                showNotification('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
                                closeModal();
                                await loadProducts();
                                applyFilters();
                                return;
                            } else {
                                throw new Error(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î HTTP ${response.status}: ${responseText}`);
                            }
                        }

                        console.log('Update parsed result:', result);

                        if (result.success === true || result.status === 'success') {
                            showNotification('‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
                        } else {
                            throw new Error(result.message || '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß');
                        }

                    } else {
                        // Add new product (‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡πÄ‡∏î‡∏¥‡∏°)
                        console.log('Adding new product with data:', formData);

                        response = await fetch(ENDPOINTS.addProduct, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(formData)
                        });

                        const responseText = await response.text();
                        console.log('Add raw response:', responseText);

                        if (!responseText.trim()) {
                            throw new Error('Server ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á response ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤');
                        }

                        try {
                            result = JSON.parse(responseText);
                        } catch (parseError) {
                            throw new Error('Server ‡∏™‡πà‡∏á response ‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà JSON: ' + responseText.substring(0, 200));
                        }

                        console.log('Add parsed result:', result);

                        if (result.success) {
                            showNotification(`‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß (‡∏£‡∏´‡∏±‡∏™: ${result.product_id})`, 'success');

                            // Upload images if any
                            if (productImages.length > 0) {
                                for (let i = 0; i < productImages.length; i++) {
                                    const image = productImages[i];
                                    if (image.startsWith('data:')) {
                                        try {
                                            const response = await fetch(image);
                                            const blob = await response.blob();
                                            const file = new File([blob], `image_${i}.jpg`, { type: 'image/jpeg' });
                                            await uploadImageFile(file, result.product_id, i === 0);
                                        } catch (uploadError) {
                                            console.error('Error uploading image:', uploadError);
                                            showNotification(`‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡πÅ‡∏ï‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà ${i + 1} ‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß`, 'warning');
                                        }
                                    }
                                }
                            }
                        } else {
                            throw new Error(result.message || '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß');
                        }
                    }

                    closeModal();
                    await loadProducts();
                    applyFilters();

                } catch (error) {
                    console.error('Error saving product:', error);

                    let errorMessage = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ';
                    if (error.message.includes('Failed to fetch')) {
                        errorMessage += '‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡πÑ‡∏î‡πâ';
                    } else {
                        errorMessage += error.message;
                    }

                    showNotification(errorMessage, 'error');
                }
            });
        }

        // Enhanced delete product function
        async function deleteProduct(id) {
            if (!confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ?')) {
                return;
            }

            try {
                console.log('Deleting product with ID:', id);

                const response = await fetch(ENDPOINTS.manageProduct, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        _method: 'DELETE',
                        product_id: id
                    })
                });

                console.log('Delete response status:', response.status);

                let result;
                try {
                    const responseText = await response.text();
                    console.log('Delete raw response:', responseText);

                    if (!responseText.trim()) {
                        throw new Error('Server ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏™‡πà‡∏á response ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤');
                    }

                    result = JSON.parse(responseText);
                } catch (parseError) {
                    console.error('JSON parse error:', parseError);

                    // ‡∏ñ‡πâ‡∏≤ response status ok ‡πÅ‡∏ï‡πà parse ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡∏ñ‡∏∑‡∏≠‡∏ß‡πà‡∏≤‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à
                    if (response.ok) {
                        showNotification('‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
                        await loadProducts();
                        applyFilters();

                        // ‡∏õ‡∏¥‡∏î view modal ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà
                        const viewModal = document.getElementById('productViewModal');
                        if (viewModal && viewModal.style.display === 'block') {
                            closeViewModal();
                        }
                        return;
                    } else {
                        throw new Error(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î HTTP ${response.status}`);
                    }
                }

                console.log('Delete parsed result:', result);

                if (result.success === true || result.status === 'success') {
                    await loadProducts();
                    applyFilters();
                    showNotification('‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');

                    // ‡∏õ‡∏¥‡∏î view modal ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡∏¥‡∏î‡∏≠‡∏¢‡∏π‡πà
                    const viewModal = document.getElementById('productViewModal');
                    if (viewModal && viewModal.style.display === 'block') {
                        closeViewModal();
                    }
                } else {
                    throw new Error(result.message || '‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß');
                }

            } catch (error) {
                console.error('Error deleting product:', error);
                showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤: ' + error.message, 'error');
            }
        }

        // Helper function to get element value safely
        function getElementValue(id) {
            const element = document.getElementById(id);
            return element ? element.value : '';
        }

        // Enhanced notification function
        function showNotification(message, type = 'info') {
            // Remove existing notifications
            document.querySelectorAll('.app-notification').forEach(n => n.remove());

            const notification = document.createElement('div');
            notification.className = 'app-notification';
            notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 15px 20px;
        border-radius: 8px;
        color: white;
        font-weight: 600;
        z-index: 3000;
        opacity: 0;
        transform: translateX(100%);
        transition: all 0.3s ease;
        max-width: 400px;
        word-wrap: break-word;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        ${type === 'success' ? 'background: #28a745;' : ''}
        ${type === 'error' ? 'background: #dc3545;' : ''}
        ${type === 'warning' ? 'background: #ffc107; color: #212529;' : ''}
        ${type === 'info' ? 'background: #17a2b8;' : ''}
    `;
            notification.textContent = message;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.opacity = '1';
                notification.style.transform = 'translateX(0)';
            }, 100);

            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, type === 'error' ? 5000 : 3000);
        }

        // Filter and search functions
        function applyFilters() {
            const searchInput = document.getElementById('searchInput');
            const categoryFilter = document.getElementById('categoryFilter');
            const stockFilter = document.getElementById('stockFilter');
            const startDateFilter = document.getElementById('startDateFilter');
            const endDateFilter = document.getElementById('endDateFilter');

            const searchTerm = searchInput ? searchInput.value.toLowerCase() : '';
            const categoryValue = categoryFilter ? categoryFilter.value : '';
            const stockValue = stockFilter ? stockFilter.value : '';
            const startDate = startDateFilter ? startDateFilter.value : '';
            const endDate = endDateFilter ? endDateFilter.value : '';

            filteredProducts = products.filter(product => {
                const matchesSearch = !searchTerm ||
                    product.name.toLowerCase().includes(searchTerm) ||
                    (product.lot && product.lot.toLowerCase().includes(searchTerm)) ||
                    (product.productCode && product.productCode.toLowerCase().includes(searchTerm)) ||
                    (product.description && product.description.toLowerCase().includes(searchTerm));

                const matchesCategory = !categoryValue || product.category === categoryValue;

                let matchesStock = true;
                if (stockValue === 'high') matchesStock = product.stock >= 100;
                else if (stockValue === 'medium') matchesStock = product.stock >= 50 && product.stock < 100;
                else if (stockValue === 'low') matchesStock = product.stock < 50;

                // Date range filter
                let matchesDateRange = true;
                if (product.receivedDate) {
                    const productDate = new Date(product.receivedDate);
                    if (!isNaN(productDate.getTime())) {
                        if (startDate) {
                            const filterStartDate = new Date(startDate);
                            matchesDateRange = matchesDateRange && productDate >= filterStartDate;
                        }
                        if (endDate) {
                            const filterEndDate = new Date(endDate);
                            matchesDateRange = matchesDateRange && productDate <= filterEndDate;
                        }
                    }
                }

                return matchesSearch && matchesCategory && matchesStock && matchesDateRange;
            });

            applySorting();
            currentPage = 1;
            renderProducts();
        }

        // Sort products function
        function applySorting() {
            const sortFilter = document.getElementById('sortFilter');
            const sortBy = sortFilter ? sortFilter.value : 'name';

            filteredProducts.sort((a, b) => {
                switch (sortBy) {
                    case 'name':
                        return a.name.localeCompare(b.name, 'th');
                    case 'stock':
                        return b.stock - a.stock;
                    case 'lot':
                        return (a.lot || '').localeCompare((b.lot || ''), 'th');
                    case 'receivedDate_desc':
                        if (!a.receivedDate && !b.receivedDate) return 0;
                        if (!a.receivedDate) return 1;
                        if (!b.receivedDate) return -1;
                        return new Date(b.receivedDate) - new Date(a.receivedDate);
                    case 'receivedDate_asc':
                        if (!a.receivedDate && !b.receivedDate) return 0;
                        if (!a.receivedDate) return 1;
                        if (!b.receivedDate) return -1;
                        return new Date(a.receivedDate) - new Date(b.receivedDate);
                    case 'supplier':
                        const supplierA = a.supplierName || getSupplierName(a.supplier) || '';
                        const supplierB = b.supplierName || getSupplierName(b.supplier) || '';
                        return supplierA.localeCompare(supplierB, 'th');
                    default:
                        return 0;
                }
            });
        }

        // Render pagination
        function renderPagination() {
            const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
            const pagination = document.getElementById('pagination');

            if (!pagination) return;

            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }

            let buttons = [];

            // Previous button
            buttons.push(`
        <button onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>
            <i class="fas fa-chevron-left"></i>
        </button>
    `);

            // Page numbers with smart pagination
            const maxVisiblePages = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisiblePages / 2));
            let endPage = Math.min(totalPages, startPage + maxVisiblePages - 1);

            if (endPage - startPage < maxVisiblePages - 1) {
                startPage = Math.max(1, endPage - maxVisiblePages + 1);
            }

            if (startPage > 1) {
                buttons.push(`<button onclick="changePage(1)">1</button>`);
                if (startPage > 2) {
                    buttons.push(`<span class="pagination-ellipsis">...</span>`);
                }
            }

            for (let i = startPage; i <= endPage; i++) {
                buttons.push(`
            <button onclick="changePage(${i})" ${i === currentPage ? 'class="active"' : ''}>
                ${i}
            </button>
        `);
            }

            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    buttons.push(`<span class="pagination-ellipsis">...</span>`);
                }
                buttons.push(`<button onclick="changePage(${totalPages})">${totalPages}</button>`);
            }

            // Next button
            buttons.push(`
        <button onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>
            <i class="fas fa-chevron-right"></i>
        </button>
    `);

            pagination.innerHTML = buttons.join('');
        }

        // Change page
        function changePage(page) {
            const totalPages = Math.ceil(filteredProducts.length / itemsPerPage);
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                renderProducts();
                // Scroll to top of table
                document.getElementById('productsTableBody')?.scrollIntoView({ behavior: 'smooth' });
            }
        }

        // Update statistics
        function updateStats() {
            const totalProducts = products.length;
            const lowStockProducts = products.filter(p => p.stock < 50).length;
            const filteredCount = filteredProducts.length;

            const totalElement = document.getElementById('totalProducts');
            const lowStockElement = document.getElementById('lowStockProducts');
            const filteredElement = document.getElementById('filteredProducts');

            if (totalElement) totalElement.textContent = totalProducts.toLocaleString();
            if (lowStockElement) lowStockElement.textContent = lowStockProducts.toLocaleString();
            if (filteredElement) filteredElement.textContent = filteredCount.toLocaleString();
        }

        // Modal functions
        function openAddModal() {
            const modalTitle = document.getElementById('modalTitle');
            const productForm = document.getElementById('productForm');
            const receivedDateInput = document.getElementById('productReceivedDate');
            const modal = document.getElementById('productModal');

            if (modalTitle) modalTitle.textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡πÉ‡∏´‡∏°‡πà';
            if (productForm) productForm.reset();

            // Set default date to today
            if (receivedDateInput) {
                const today = new Date().toISOString().split('T')[0];
                receivedDateInput.value = today;
            }

            currentEditId = null;
            productImages = [];
            renderImagePreviews();

            if (modal) modal.style.display = 'block';
        }

        function closeModal() {
            const modal = document.getElementById('productModal');
            if (modal) modal.style.display = 'none';
            currentEditId = null;
            productImages = [];
        }

        // Enhanced edit product function
        async function editProduct(id) {
            const product = products.find(p => p.id === id);
            if (!product) {
                showNotification('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç', 'error');
                return;
            }

            currentEditId = id;

            const modalTitle = document.getElementById('modalTitle');
            if (modalTitle) modalTitle.textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤';

            // Fill form fields
            const fields = {
                productName: product.name,
                productDescription: product.description,
                productCategory: product.category,
                productLot: product.lot,
                productStock: product.stock,
                productPrice: product.price,
                productReceivedDate: product.receivedDate,
                productSupplier: product.supplier
            };

            Object.entries(fields).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) element.value = value || '';
            });

            // Fill dimension fields
            if (product.dimensions) {
                const dimensionFields = {
                    productWidth: product.dimensions.width?.value || '',
                    widthUnit: product.dimensions.width?.unit || 'mm',
                    productLength: product.dimensions.length?.value || '',
                    lengthUnit: product.dimensions.length?.unit || 'mm',
                    productHeight: product.dimensions.height?.value || '',
                    heightUnit: product.dimensions.height?.unit || 'mm',
                    productWeight: product.dimensions.weight?.value || '',
                    weightUnit: product.dimensions.weight?.unit || 'kg'
                };

                Object.entries(dimensionFields).forEach(([id, value]) => {
                    const element = document.getElementById(id);
                    if (element) element.value = value;
                });
            }

            // Load existing images
            productImages = product.images ? [...product.images] : [];
            renderImagePreviews();

            const modal = document.getElementById('productModal');
            if (modal) modal.style.display = 'block';
        }

        // Enhanced view product function
        function viewProduct(id) {
            const product = products.find(p => p.id === id);
            if (!product) {
                showNotification('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π', 'error');
                return;
            }

            currentViewId = id;

            // Fill basic info
            const elements = {
                viewProductCode: product.productCode || product.id,
                viewProductName: product.name,
                viewProductDescription: product.description || '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢',
                viewProductLot: product.lot || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏',
                viewProductStock: `${product.stock} ‡∏ä‡∏¥‡πâ‡∏ô`,
                viewProductPrice: product.price > 0 ? `‡∏ø${product.price.toLocaleString()}` : '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏Ñ‡∏≤',
                viewProductDate: formatDate(product.receivedDate),
                viewProductSupplier: product.supplierName || getSupplierName(product.supplier) || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'
            };

            Object.entries(elements).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) element.textContent = value;
            });

            // Set category badge
            const categoryBadge = document.getElementById('viewProductCategory');
            if (categoryBadge) {
                categoryBadge.textContent = product.categoryName || getCategoryName(product.category) || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏';
                categoryBadge.setAttribute('data-category', product.category);
            }

            // Handle images
            const mainImageContainer = document.getElementById('viewMainImageContainer');
            const thumbnailGallery = document.getElementById('viewThumbnailGallery');

            if (mainImageContainer && thumbnailGallery) {
                if (product.images && product.images.length > 0) {
                    // Set main image
                    mainImageContainer.innerHTML = `
                <img src="${product.images[0]}" alt="${product.name}" onclick="viewProductImages('${product.id}')" loading="lazy">
            `;

                    // Set thumbnails
                    if (product.images.length > 1) {
                        thumbnailGallery.innerHTML = product.images.map((image, index) => `
                    <div class="thumbnail ${index === 0 ? 'active' : ''}" onclick="changeMainImage('${image}', ${index})">
                        <img src="${image}" alt="‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà ${index + 1}" loading="lazy">
                    </div>
                `).join('');
                    } else {
                        thumbnailGallery.innerHTML = '';
                    }
                } else {
                    mainImageContainer.innerHTML = `
                <div class="no-image-placeholder">
                    <i class="fas fa-image"></i>
                    <span>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</span>
                </div>
            `;
                    thumbnailGallery.innerHTML = '';
                }
            }

            // Handle dimensions
            const dimensionsSection = document.getElementById('viewDimensionsSection');
            const dimensionsGrid = document.getElementById('viewDimensionsGrid');

            if (dimensionsSection && dimensionsGrid && product.dimensions) {
                const dimensions = [];

                if (product.dimensions.width && product.dimensions.width.value) {
                    dimensions.push({
                        label: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á',
                        value: product.dimensions.width.value,
                        unit: product.dimensions.width.unit
                    });
                }

                if (product.dimensions.length && product.dimensions.length.value) {
                    dimensions.push({
                        label: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏¢‡∏≤‡∏ß',
                        value: product.dimensions.length.value,
                        unit: product.dimensions.length.unit
                    });
                }

                if (product.dimensions.height && product.dimensions.height.value) {
                    dimensions.push({
                        label: '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏π‡∏á/‡∏´‡∏ô‡∏≤',
                        value: product.dimensions.height.value,
                        unit: product.dimensions.height.unit
                    });
                }

                if (product.dimensions.weight && product.dimensions.weight.value) {
                    dimensions.push({
                        label: '‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å',
                        value: product.dimensions.weight.value,
                        unit: product.dimensions.weight.unit
                    });
                }

                if (dimensions.length > 0) {
                    dimensionsGrid.innerHTML = dimensions.map(dim => `
                <div class="dimension-item">
                    <div class="dimension-label">${dim.label}</div>
                    <div class="dimension-value">${dim.value}<span class="dimension-unit">${dim.unit}</span></div>
                </div>
            `).join('');
                    dimensionsSection.style.display = 'block';
                } else {
                    dimensionsSection.style.display = 'none';
                }
            }

            const modal = document.getElementById('productViewModal');
            if (modal) modal.style.display = 'block';
        }

        // View product images in gallery
        function viewProductImages(productId) {
            const product = products.find(p => p.id === productId);
            if (product && product.images && product.images.length > 0) {
                currentGalleryImages = [...product.images];
                currentImageIndex = 0;
                openImageGallery();
            } else {
                showNotification('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ô‡∏µ‡πâ', 'info');
            }
        }

        // Change main image in view modal
        function changeMainImage(imageSrc, index) {
            const container = document.getElementById('viewMainImageContainer');
            if (container) {
                container.innerHTML = `
            <img src="${imageSrc}" alt="‡∏£‡∏π‡∏õ‡∏´‡∏•‡∏±‡∏Å" onclick="viewProductImages('${currentViewId}')" loading="lazy">
        `;
            }

            // Update active thumbnail
            document.querySelectorAll('.thumbnail').forEach((thumb, i) => {
                thumb.classList.toggle('active', i === index);
            });
        }

        // Close view modal
        function closeViewModal() {
            const modal = document.getElementById('productViewModal');
            if (modal) modal.style.display = 'none';
            currentViewId = null;
        }

        // Edit product from view modal
        function editProductFromView() {
            if (currentViewId) {
                closeViewModal();
                editProduct(currentViewId);
            }
        }

        // Delete product from view modal
        function deleteProductFromView() {
            if (currentViewId) {
                closeViewModal();
                deleteProduct(currentViewId);
            }
        }

        // Advanced search with debounce
        let searchTimeout;
        function debounceSearch() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(applyFilters, 300);
        }

        // Sort products when dropdown changes
        function onSortChange() {
            applySorting();
            renderProducts();
        }

        // Clear date filters
        function clearDateFilters() {
            const startDate = document.getElementById('startDateFilter');
            const endDate = document.getElementById('endDateFilter');

            if (startDate) startDate.value = '';
            if (endDate) endDate.value = '';

            applyFilters();
            showNotification('‡∏•‡πâ‡∏≤‡∏á‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß', 'info');
        }

        // Reset all filters
        function resetAllFilters() {
            const searchInput = document.getElementById('searchInput');
            const categoryFilter = document.getElementById('categoryFilter');
            const stockFilter = document.getElementById('stockFilter');
            const sortFilter = document.getElementById('sortFilter');
            const startDateFilter = document.getElementById('startDateFilter');
            const endDateFilter = document.getElementById('endDateFilter');

            if (searchInput) searchInput.value = '';
            if (categoryFilter) categoryFilter.value = '';
            if (stockFilter) stockFilter.value = '';
            if (sortFilter) sortFilter.value = 'name';
            if (startDateFilter) startDateFilter.value = '';
            if (endDateFilter) endDateFilter.value = '';

            applyFilters();
            showNotification('‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡πâ‡∏ß', 'success');
        }

        // Drag and drop functionality
        function setupDragAndDrop() {
            const dropZone = document.getElementById('dropZone');
            const imageInput = document.getElementById('imageInput');
            const imagesSection = document.getElementById('imagesSection');

            if (!dropZone || !imageInput) return;

            // Prevent default drag behaviors
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
                document.body.addEventListener(eventName, preventDefaults, false);
            });

            // Highlight drop zone when item is dragged over it
            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, highlight, false);
                if (imagesSection) imagesSection.addEventListener(eventName, highlight, false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, unhighlight, false);
                if (imagesSection) imagesSection.addEventListener(eventName, unhighlight, false);
            });

            // Handle dropped files
            dropZone.addEventListener('drop', handleDrop, false);

            // Handle file input change
            imageInput.addEventListener('change', function (e) {
                handleImageFiles(e.target.files);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            function highlight() {
                dropZone.classList.add('drag-over');
                if (imagesSection) imagesSection.classList.add('drag-over');
            }

            function unhighlight() {
                dropZone.classList.remove('drag-over');
                if (imagesSection) imagesSection.classList.remove('drag-over');
            }

            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                handleImageFiles(files);
            }
        }

        // Toggle sidebar
        function toggleSidebar() {
            const sidebar = document.getElementById("sidebar");
            const main = document.querySelector(".main-content");

            if (sidebar) {
                sidebar.classList.toggle("show");
                if (main) main.classList.toggle("overlay");
            }
        }

        // Show different sections
        function showSection(section) {
            if (section === 'dashboard') {
                window.location.href = 'dashboard_admin.html';
            } else if (section === 'orders') {
                window.location.href = 'orders_admin.html';
            } else if (section === 'admins') {
                window.location.href = 'admins_admin.html';
            } else if (section === 'reports') {
                window.location.href = 'reports_admin.html';
            } else if (section === 'products') {
                // Close sidebar on mobile after selection
                if (window.innerWidth <= 768) {
                    const sidebar = document.getElementById("sidebar");
                    const main = document.querySelector(".main-content");
                    if (sidebar && main) {
                        sidebar.classList.remove("show");
                        main.classList.remove("overlay");
                    }
                }
            }
        }

        // Add refresh function
        async function refreshProducts() {
            try {
                const refreshBtn = document.querySelector('.refresh-btn');
                if (refreshBtn) {
                    refreshBtn.disabled = true;
                    refreshBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
                }

                await loadProducts();
                applyFilters();
                showNotification('‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß', 'success');
            } catch (error) {
                console.error('Error refreshing products:', error);
                showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•', 'error');
            } finally {
                const refreshBtn = document.querySelector('.refresh-btn');
                if (refreshBtn) {
                    refreshBtn.disabled = false;
                    refreshBtn.innerHTML = '<i class="fas fa-sync-alt"></i>';
                }
            }
        }

        // Enhanced event listeners setup
        function setupEventListeners() {
            // Search input with debounce
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', debounceSearch);
            }

            // Filter dropdowns
            const categoryFilter = document.getElementById('categoryFilter');
            if (categoryFilter) {
                categoryFilter.addEventListener('change', applyFilters);
            }

            const stockFilter = document.getElementById('stockFilter');
            if (stockFilter) {
                stockFilter.addEventListener('change', applyFilters);
            }

            const sortFilter = document.getElementById('sortFilter');
            if (sortFilter) {
                sortFilter.addEventListener('change', onSortChange);
            }

            // Date filters
            const startDateFilter = document.getElementById('startDateFilter');
            if (startDateFilter) {
                startDateFilter.addEventListener('change', applyFilters);
            }

            const endDateFilter = document.getElementById('endDateFilter');
            if (endDateFilter) {
                endDateFilter.addEventListener('change', applyFilters);
            }

            // Modal close events
            const productModal = document.getElementById('productModal');
            if (productModal) {
                productModal.addEventListener('click', function (e) {
                    if (e.target === this) {
                        closeModal();
                    }
                });
            }

            const productViewModal = document.getElementById('productViewModal');
            if (productViewModal) {
                productViewModal.addEventListener('click', function (e) {
                    if (e.target === this) {
                        closeViewModal();
                    }
                });
            }

            const imageGalleryModal = document.getElementById('imageGalleryModal');
            if (imageGalleryModal) {
                imageGalleryModal.addEventListener('click', function (e) {
                    if (e.target === this) {
                        closeImageGallery();
                    }
                });
            }

            // Keyboard shortcuts
            document.addEventListener('keydown', function (e) {
                // Close modals with Escape key
                if (e.key === 'Escape') {
                    if (productModal && productModal.style.display === 'block') {
                        closeModal();
                    }
                    if (productViewModal && productViewModal.style.display === 'block') {
                        closeViewModal();
                    }
                    if (imageGalleryModal && imageGalleryModal.style.display === 'block') {
                        closeImageGallery();
                    }
                }

                // Gallery navigation with arrow keys
                if (imageGalleryModal && imageGalleryModal.style.display === 'block') {
                    if (e.key === 'ArrowLeft') {
                        e.preventDefault();
                        navigateImage(-1);
                    } else if (e.key === 'ArrowRight') {
                        e.preventDefault();
                        navigateImage(1);
                    }
                }

                // Ctrl+N or Cmd+N for new product
                if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                    e.preventDefault();
                    openAddModal();
                }

                // Ctrl+F or Cmd+F for search focus
                if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
                    e.preventDefault();
                    if (searchInput) {
                        searchInput.focus();
                        searchInput.select();
                    }
                }
            });

            // Paste image functionality
            document.addEventListener('paste', function (e) {
                if (productModal && productModal.style.display === 'block') {
                    const items = e.clipboardData.items;
                    for (let i = 0; i < items.length; i++) {
                        if (items[i].type.indexOf('image') !== -1) {
                            const file = items[i].getAsFile();
                            handleImageFiles([file]);
                            showNotification('‡∏ß‡∏≤‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏à‡∏≤‡∏Å‡∏Ñ‡∏•‡∏¥‡∏õ‡∏ö‡∏≠‡∏£‡πå‡∏î‡πÅ‡∏•‡πâ‡∏ß', 'success');
                            break;
                        }
                    }
                }
            });

            // Close sidebar when clicking outside (mobile only)
            document.addEventListener("click", function (e) {
                const sidebar = document.getElementById("sidebar");
                const toggle = document.querySelector(".navbar-toggle");
                const main = document.querySelector(".main-content");

                if (!sidebar) return;

                const clickedOutside = !sidebar.contains(e.target) &&
                    (!toggle || !toggle.contains(e.target));

                if (sidebar.classList.contains("show") && clickedOutside && window.innerWidth <= 768) {
                    sidebar.classList.remove("show");
                    if (main) main.classList.remove("overlay");
                }
            });
        }

        // Export functions for global access
        window.viewProduct = viewProduct;
        window.editProduct = editProduct;
        window.deleteProduct = deleteProduct;
        window.openAddModal = openAddModal;
        window.closeModal = closeModal;
        window.closeViewModal = closeViewModal;
        window.editProductFromView = editProductFromView;
        window.deleteProductFromView = deleteProductFromView;
        window.changeMainImage = changeMainImage;
        window.changePage = changePage;
        window.toggleSidebar = toggleSidebar;
        window.showSection = showSection;
        window.clearDateFilters = clearDateFilters;
        window.resetAllFilters = resetAllFilters;
        window.viewProductImages = viewProductImages;
        window.viewImage = viewImage;
        window.removeImage = removeImage;
        window.closeImageGallery = closeImageGallery;
        window.navigateImage = navigateImage;
        window.onSortChange = onSortChange;
        window.applyFilters = applyFilters;
        window.debounceSearch = debounceSearch;
        window.refreshProducts = refreshProducts;
        window.showNotification = showNotification;

        // Main initialization
        document.addEventListener('DOMContentLoaded', function () {
            console.log('Initializing Products Management System...');

            Promise.resolve()
                .then(() => {
                    setupEventListeners();
                    setupDragAndDrop();
                    setupProductForm();
                    return loadInitialData();
                })
                .then(() => {
                    console.log('Products Management System initialized successfully');
                })
                .catch(error => {
                    console.error('Failed to initialize Products Management System:', error);
                    showNotification('‡∏£‡∏∞‡∏ö‡∏ö‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÑ‡∏î‡πâ: ' + error.message, 'error');
                });
        });

    </script>
</body>

</html>