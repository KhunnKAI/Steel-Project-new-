<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>จัดการผู้ดูแล - ระบบจัดการร้านค้า</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter';
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        .navbar-toggle {
            position: fixed;
            top: 20px;
            left: 20px;
            font-size: 24px;
            cursor: pointer;
            z-index: 1001;
            color: #333;
            background: white;
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: none;
            transition: all 0.3s ease;
        }

        .navbar-toggle:hover {
            background: #f8f9fa;
            transform: scale(1.05);
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        .main-content {
            flex: 1;
            padding: 30px;
            margin-left: 260px;
            transition: all 0.3s ease;
            min-height: 100vh;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }

        .header h1 {
            font-size: 28px;
            color: #333;
            font-weight: 600;
        }

        .search-add {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .search-container {
            position: relative;
        }

        .search-container input[type="text"] {
            padding: 12px 45px 12px 15px;
            width: 350px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .search-container input[type="text"]:focus {
            outline: none;
            border-color: #990000;
            box-shadow: 0 0 0 3px rgba(153, 0, 0, 0.1);
        }

        .search-container i {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }

        .add-btn {
            padding: 12px 24px;
            background: linear-gradient(45deg, #990000, #cc0000);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .add-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(153, 0, 0, 0.3);
        }

        .filters-section {
            background: white;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }

        .filters-row {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 5px;
        }

        .filter-group label {
            font-size: 14px;
            color: #666;
            font-weight: 500;
        }

        .filter-group select {
            padding: 8px 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
        }

        .stats-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
        }

        .stat-card.total::before { background: linear-gradient(90deg, #007bff, #0056b3); }
        .stat-card.active::before { background: linear-gradient(90deg, #28a745, #20c997); }
        .stat-card.inactive::before { background: linear-gradient(90deg, #dc3545, #c82333); }
        .stat-card.manager::before { background: linear-gradient(90deg, #6f42c1, #5a2d91); }
        .stat-card.sales::before { background: linear-gradient(90deg, #fd7e14, #e55100); }

        .stat-number {
            font-size: 24px;
            font-weight: 700;
            color: #333;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 14px;
        }

        .table-container {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #f0f0f0;
        }

        th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        td {
            color: #555;
        }

        .staff-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .staff-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 16px;
        }

        .staff-details {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .staff-name {
            font-weight: 600;
            color: #333;
            font-size: 16px;
        }

        .staff-phone {
            font-size: 13px;
            color: #666;
        }

        .staff-department {
            font-size: 11px;
            color: #888;
            background: #f8f9fa;
            padding: 2px 6px;
            border-radius: 4px;
        }

        .role-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .role-manager { background: #e7e3ff; color: #6f42c1; }
        .role-sales { background: #fff3cd; color: #856404; }
        .role-warehouse { background: #cce5ff; color: #004085; }
        .role-shipping { background: #d4edda; color: #155724; }
        .role-accounting { background: #f8d7da; color: #721c24; }
        .role-super { background: #e7e3ff; color: #6f42c1; }
        .role-admin { background: #cce5ff; color: #007bff; }
        .role-moderator { background: #d4edda; color: #28a745; }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-active { background: #d4edda; color: #155724; }
        .status-inactive { background: #f8d7da; color: #721c24; }

        .actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .actions button {
            padding: 8px 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .actions button:hover {
            transform: translateY(-2px);
        }

        .view-btn {
            background: linear-gradient(45deg, #17a2b8, #20c997);
            color: white;
        }

        .view-btn:hover {
            box-shadow: 0 4px 12px rgba(23, 162, 184, 0.4);
        }

        .edit-btn {
            background: linear-gradient(45deg, #ffc107, #ffb300);
            color: white;
        }

        .edit-btn:hover {
            box-shadow: 0 4px 12px rgba(255, 193, 7, 0.4);
        }

        .toggle-btn {
            background: linear-gradient(45deg, #6c757d, #5a6268);
            color: white;
        }

        .toggle-btn:hover {
            box-shadow: 0 4px 12px rgba(108, 117, 125, 0.4);
        }

        .delete-btn {
            background: linear-gradient(45deg, #dc3545, #c82333);
            color: white;
        }

        .delete-btn:hover {
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.4);
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
            padding: 20px;
        }

        .pagination button {
            padding: 8px 12px;
            border: 2px solid #e9ecef;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pagination button:hover,
        .pagination button.active {
            background: #990000;
            color: white;
            border-color: #990000;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .modal-header h2 {
            color: #333;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 14px;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #990000;
        }

        .form-group input[type="checkbox"] {
            width: auto;
            margin-right: 8px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }

        .permissions-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
        }

        .permissions-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .permission-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: white;
            border-radius: 6px;
        }

        .form-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .form-actions button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
        }

        .save-btn {
            background: #990000;
            color: white;
        }

        .cancel-form-btn {
            background: #6c757d;
            color: white;
        }

        /* Sidebar Styles */
        .sidebar {
            background: #940606;
            color: white;
            width: 260px;
            min-width: 260px;
            height: 100%;
            position: fixed;
            display: flex;
            flex-direction: column;
            transition: all 0.3s ease;
            box-shadow: 4px 0 20px rgba(0,0,0,0.1);
        }

        .sidebar.collapsed {
            width: 0;
            min-width: 0;
            overflow: hidden;
        }

        .logo {
            padding: 30px 20px;
            text-align: center;
            border-bottom: 1px solid #940606;
            font-size: 18px;
            font-weight: 600;
            margin-top: 10px;
        }

        nav ul {
            list-style: none;
            padding: 20px 0;
        }

        nav li {
            margin: 5px 0;
            transition: all 0.3s ease;
        }

        nav li a {
            display: flex;
            align-items: center;
            padding: 15px 25px;
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }

        nav li a i {
            margin-right: 12px;
            width: 20px;
            text-align: center;
        }

        nav li.active a,
        nav li a:hover {
            background: #051A37;
        }

        @media screen and (max-width: 768px) {
            .navbar-toggle {
                display: block;
            }

            .main-content {
                padding: 80px 20px 20px;
                margin-left: 0;
            }

            .header {
                flex-direction: column;
                gap: 15px;
            }

            .search-container input[type="text"] {
                width: 100%;
            }

            .filters-row {
                flex-direction: column;
                align-items: stretch;
            }

            .staff-info {
                flex-direction: column;
                text-align: center;
                gap: 10px;
            }

            table {
                font-size: 14px;
            }

            th, td {
                padding: 10px 8px;
            }

            .actions {
                flex-direction: column;
            }

            .sidebar {
                position: fixed;
                top: 0;
                left: -260px;
                height: 100vh;
                z-index: 1000;
            }

            .sidebar.show {
                left: 0;
            }

            .form-row {
                grid-template-columns: 1fr;
            }
        }

        @media screen and (max-width: 480px) {
            .actions button {
                font-size: 11px;
                padding: 6px 8px;
            }

            .modal-content {
                width: 95%;
                padding: 20px;
            }
        }
    </style>
</head>

<body>
    <div class="navbar-toggle" onclick="toggleSidebar()">
        <i class="fas fa-bars"></i>
    </div>

    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar" id="sidebar">
            <div class="logo">
                <div>
                    <img src="image/logo_cropped.png" width="100px" alt="Logo">
                </div>
                <h2>ระบบผู้ดูแล</h2>
            </div>
            
            <nav>
                <ul>
                    <li>
                        <a href="dashboard_admin.html" onclick="showSection('dashboard')">
                            <i class="fas fa-tachometer-alt"></i>
                            แดชบอร์ด
                        </a>
                    </li>
                    <li>
                        <a href="products_admin.html" onclick="showSection('products')">
                            <i class="fas fa-box"></i>
                            จัดการสินค้า
                        </a>
                    </li>
                    <li>
                        <a href="orders_admin.html" onclick="showSection('orders')">
                            <i class="fas fa-shopping-cart"></i>
                            จัดการคำสั่งซื้อ
                        </a>
                    </li>
                    <li class="active">
                        <a href="admins_admin.html" onclick="showSection('admins')">
                            <i class="fas fa-users-cog"></i>
                            จัดการผู้ดูแล
                        </a>
                    </li>
                    <li>
                        <a href="reports_admin.html" onclick="showSection('reports')">
                            <i class="fas fa-chart-bar"></i>
                            รายงาน
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>

        <main class="main-content">
            <div class="header">
                <h1><i class="fas fa-users-cog"></i> จัดการผู้ดูแลและพนักงาน</h1>
                <div class="search-add">
                    <div class="search-container">
                        <input type="text" id="searchInput" placeholder="ค้นหาชื่อ หรือบทบาท...">
                        <i class="fas fa-search"></i>
                    </div>
                    <button class="add-btn" onclick="openAddModal()">
                        <i class="fas fa-user-plus"></i> เพิ่มพนักงาน
                    </button>
                </div>
            </div>

            <div class="stats-row">
                <div class="stat-card total">
                    <div class="stat-number" id="totalStaff">0</div>
                    <div class="stat-label">พนักงานทั้งหมด</div>
                </div>
                <div class="stat-card active">
                    <div class="stat-number" id="activeStaff">0</div>
                    <div class="stat-label">ใช้งานอยู่</div>
                </div>
                <div class="stat-card manager">
                    <div class="stat-number" id="managerCount">0</div>
                    <div class="stat-label">ผู้จัดการ</div>
                </div>
                <div class="stat-card sales">
                    <div class="stat-number" id="salesCount">0</div>
                    <div class="stat-label">พนักงานขาย</div>
                </div>
                <div class="stat-card inactive">
                    <div class="stat-number" id="warehouseCount">0</div>
                    <div class="stat-label">พนักงานคลัง</div>
                </div>
            </div>

            <div class="filters-section">
                <div class="filters-row">
                    <div class="filter-group">
                        <label>บทบาท</label>
                        <select id="roleFilter">
                            <option value="">ทั้งหมด</option>
                            <option value="manager">ผู้จัดการ</option>
                            <option value="sales">พนักงานขาย</option>
                            <option value="warehouse">พนักงานคลัง</option>
                            <option value="shipping">พนักงานขนส่ง</option>
                            <option value="accounting">พนักงานบัญชี</option>
                            <option value="super">ผู้ดูแลระบบ</option>
                            <option value="admin">ผู้ดูแล</option>
                            <option value="moderator">ผู้ช่วยดูแล</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>แผนก</label>
                        <select id="departmentFilter">
                            <option value="">ทั้งหมด</option>
                            <option value="management">บริหาร</option>
                            <option value="sales">ขาย</option>
                            <option value="warehouse">คลังสินค้า</option>
                            <option value="logistics">ขนส่ง</option>
                            <option value="accounting">บัญชี</option>
                            <option value="it">เทคโนโลยีสารสนเทศ</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>สถานะ</label>
                        <select id="statusFilter">
                            <option value="">ทั้งหมด</option>
                            <option value="active">ใช้งานอยู่</option>
                            <option value="inactive">ไม่ได้ใช้งาน</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>เรียงตาม</label>
                        <select id="sortFilter">
                            <option value="name">ชื่อ</option>
                            <option value="role">บทบาท</option>
                            <option value="department">แผนก</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="table-container">
                <table id="staffTable">
                    <thead>
                        <tr>
                            <th>พนักงาน</th>
                            <th>บทบาท</th>
                            <th>แผนก</th>
                            <th>สถานะ</th>
                            <th>การจัดการ</th>
                        </tr>
                    </thead>
                    <tbody id="staffTableBody">
                        <!-- Staff rows will be dynamically inserted here -->
                    </tbody>
                </table>
            </div>

            <div class="pagination" id="pagination">
                <!-- Pagination buttons will be inserted here -->
            </div>
        </main>
    </div>

    <!-- Add/Edit Staff Modal -->
    <div id="staffModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">เพิ่มพนักงานใหม่</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            
            <form id="staffForm">
                <div class="form-row">
                    <div class="form-group">
                        <label>ชื่อ-นามสกุล *</label>
                        <input type="text" id="staffName" required>
                    </div>
                    <div class="form-group">
                        <label>เบอร์โทรศัพท์</label>
                        <input type="tel" id="staffPhone" placeholder="08X-XXX-XXXX">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>รหัสพนักงาน</label>
                        <input type="text" id="staffCode" placeholder="EMP001">
                    </div>
                    <div class="form-group">
                        <label>บทบาท *</label>
                        <select id="staffRole" required onchange="updateDepartmentAndPermissions()">
                            <option value="">เลือกบทบาท</option>
                            <option value="manager">ผู้จัดการ</option>
                            <option value="sales">พนักงานขาย</option>
                            <option value="warehouse">พนักงานคลัง</option>
                            <option value="shipping">พนักงานขนส่ง</option>
                            <option value="accounting">พนักงานบัญชี</option>
                            <option value="super">ผู้ดูแลระบบ (สิทธิ์เต็ม)</option>
                            <option value="admin">ผู้ดูแล (สิทธิ์หลัก)</option>
                            <option value="moderator">ผู้ช่วยดูแล (สิทธิ์จำกัด)</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>แผนก *</label>
                    <select id="staffDepartment" required>
                        <option value="">เลือกแผนก</option>
                        <option value="management">บริหาร</option>
                        <option value="sales">ขาย</option>
                        <option value="warehouse">คลังสินค้า</option>
                        <option value="logistics">ขนส่ง</option>
                        <option value="accounting">บัญชี</option>
                        <option value="it">เทคโนโลยีสารสนเทศ</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>รหัสผ่าน *</label>
                    <input type="password" id="staffPassword" required>
                    <small style="color: #666; font-size: 12px;">รหัสผ่านต้องมีอย่างน้อย 8 ตัวอักษร</small>
                </div>
                <div class="form-group">
                    <label>ยืนยันรหัสผ่าน *</label>
                    <input type="password" id="staffPasswordConfirm" required>
                </div>
                
                <div class="form-group">
                    <label>สิทธิ์การใช้งาน</label>
                    <div class="permissions-section">
                        <div class="permissions-grid" id="permissionsGrid">
                            <div class="permission-item">
                                <input type="checkbox" id="perm-dashboard" value="dashboard">
                                <label for="perm-dashboard">แดชบอร์ด</label>
                            </div>
                            <div class="permission-item">
                                <input type="checkbox" id="perm-products" value="products">
                                <label for="perm-products">จัดการสินค้า</label>
                            </div>
                            <div class="permission-item">
                                <input type="checkbox" id="perm-orders" value="orders">
                                <label for="perm-orders">จัดการคำสั่งซื้อ</label>
                            </div>
                            <div class="permission-item">
                                <input type="checkbox" id="perm-admins" value="admins">
                                <label for="perm-admins">จัดการผู้ดูแล</label>
                            </div>
                            <div class="permission-item">
                                <input type="checkbox" id="perm-reports" value="reports">
                                <label for="perm-reports">รายงาน</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="staffActive" checked>
                        <label for="staffActive">เปิดใช้งานทันที</label>
                    </div>
                </div>
                <div class="form-group">
                    <label>หมายเหตุ</label>
                    <textarea id="staffNotes" rows="3" placeholder="หมายเหตุเพิ่มเติม..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="cancel-form-btn" onclick="closeModal()">ยกเลิก</button>
                    <button type="submit" class="save-btn">บันทึก</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Staff Details Modal -->
    <div id="staffDetailsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="staffDetailsTitle">รายละเอียดพนักงาน</h2>
                <button class="close-btn" onclick="closeStaffDetailsModal()">&times;</button>
            </div>
            
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                    <h3 style="color: #333; margin-bottom: 15px;"><i class="fas fa-user"></i> ข้อมูลส่วนตัว</h3>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span style="font-weight: 600; color: #666;">ชื่อ:</span>
                        <span style="color: #333;" id="detailName"></span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span style="font-weight: 600; color: #666;">เบอร์โทร:</span>
                        <span style="color: #333;" id="detailPhone"></span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span style="font-weight: 600; color: #666;">รหัสพนักงาน:</span>
                        <span style="color: #333;" id="detailCode"></span>
                    </div>
                </div>
                
                <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                    <h3 style="color: #333; margin-bottom: 15px;"><i class="fas fa-briefcase"></i> ข้อมูลงาน</h3>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span style="font-weight: 600; color: #666;">บทบาท:</span>
                        <span id="detailRole"></span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span style="font-weight: 600; color: #666;">แผนก:</span>
                        <span style="color: #333;" id="detailDepartment"></span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <span style="font-weight: 600; color: #666;">สถานะ:</span>
                        <span id="detailStatus"></span>
                    </div>
                </div>
            </div>

            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px;">
                <h3 style="color: #333; margin-bottom: 15px;"><i class="fas fa-key"></i> สิทธิ์การใช้งาน</h3>
                <div id="detailPermissions" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px;">
                    <!-- Permissions will be inserted here -->
                </div>
            </div>

            <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-top: 20px;">
                <h3 style="color: #333; margin-bottom: 15px;"><i class="fas fa-sticky-note"></i> หมายเหตุ</h3>
                <p id="detailNotes" style="color: #666; line-height: 1.5;"></p>
            </div>
        </div>
    </div>

    <script>
        // Sample staff data (simplified - removed email, salary, startDate)
        let staff = [
            // Manager (1 person)
            {
                id: 1,
                name: "นายวิชา ผู้จัดการ",
                phone: "089-123-4567",
                code: "MGR001",
                role: "manager",
                department: "management",
                status: "active",
                permissions: ["dashboard", "products", "orders", "admins", "reports"],
                notes: "ผู้จัดการฝ่ายขาย มีประสบการณ์ 10 ปี"
            },
            // Sales Staff (3 people)
            {
                id: 2,
                name: "นางสาวสุดา นักขาย",
                phone: "081-987-6543",
                code: "SAL001",
                role: "sales",
                department: "sales",
                status: "active",
                permissions: ["dashboard", "products", "orders"],
                notes: "พนักงานขายอาวุโส ดูแลลูกค้าใหญ่"
            },
            {
                id: 3,
                name: "นายอนุชา ขายดี",
                phone: "088-555-7777",
                code: "SAL002",
                role: "sales",
                department: "sales",
                status: "active",
                permissions: ["dashboard", "products", "orders"],
                notes: "พนักงานขายรุ่นใหม่ มีศักยภาพ"
            },
            {
                id: 4,
                name: "นางมาลี ขายเก่ง",
                phone: "082-111-2222",
                code: "SAL003",
                role: "sales",
                department: "sales",
                status: "active",
                permissions: ["dashboard", "products", "orders"],
                notes: "พนักงานขายที่มีประสบการณ์ในการดูแลลูกค้า"
            },
            // Warehouse Staff (3 people)
            {
                id: 5,
                name: "นายสมชาย คลังสินค้า",
                phone: "099-888-9999",
                code: "WH001",
                role: "warehouse",
                department: "warehouse",
                status: "active",
                permissions: ["dashboard", "products"],
                notes: "หัวหน้าคลังสินค้า มีความรับผิดชอบสูง"
            },
            {
                id: 6,
                name: "นายประยุทธ์ ดูแลสต็อก",
                phone: "095-444-3333",
                code: "WH002",
                role: "warehouse",
                department: "warehouse",
                status: "active",
                permissions: ["dashboard", "products"],
                notes: "ผู้เชี่ยวชาญในการจัดการสินค้า"
            },
            {
                id: 7,
                name: "นายเสรี คลังใหญ่",
                phone: "096-777-8888",
                code: "WH003",
                role: "warehouse",
                department: "warehouse",
                status: "active",
                permissions: ["dashboard", "products"],
                notes: "พนักงานคลังที่มีความแม่นยำในการนับสต็อก"
            },
            // Shipping Staff (2 people)
            {
                id: 8,
                name: "นายสมศักดิ์ ขนส่ง",
                phone: "087-123-9999",
                code: "SH001",
                role: "shipping",
                department: "logistics",
                status: "active",
                permissions: ["dashboard", "orders"],
                notes: "หัวหน้าทีมขนส่ง มีใบขับขี่ทุกประเภท"
            },
            {
                id: 9,
                name: "นายธนาคาร ส่งด่วน",
                phone: "094-555-1111",
                code: "SH002",
                role: "shipping",
                department: "logistics",
                status: "active",
                permissions: ["dashboard", "orders"],
                notes: "คนขับรถบรรทุกมือขับขี่เก่ง"
            },
            // Accounting Staff (1 person)
            {
                id: 10,
                name: "นางวิภา นักบัญชี",
                phone: "089-777-6666",
                code: "ACC001",
                role: "accounting",
                department: "accounting",
                status: "active",
                permissions: ["dashboard", "orders", "reports"],
                notes: "นักบัญชีหัวหน้า ดูแลการเงินทั้งหมด"
            },
            // Admin (1 person)
            {
                id: 11,
                name: "นายแอดมิน ระบบ",
                phone: "080-000-1234",
                code: "ADM001",
                role: "admin",
                department: "it",
                status: "active",
                permissions: ["dashboard", "products", "orders", "admins", "reports"],
                notes: "ผู้ดูแลระบบหลัก"
            }
        ];

        let currentPage = 1;
        const itemsPerPage = 10;
        let filteredStaff = [...staff];
        let currentEditId = null;

        // Role mapping
        const roleMap = {
            'manager': { class: 'role-manager', text: 'ผู้จัดการ', avatar: '#6f42c1' },
            'sales': { class: 'role-sales', text: 'พนักงานขาย', avatar: '#fd7e14' },
            'warehouse': { class: 'role-warehouse', text: 'พนักงานคลัง', avatar: '#007bff' },
            'shipping': { class: 'role-shipping', text: 'พนักงานขนส่ง', avatar: '#28a745' },
            'accounting': { class: 'role-accounting', text: 'พนักงานบัญชี', avatar: '#dc3545' },
            'super': { class: 'role-super', text: 'ผู้ดูแลระบบ', avatar: '#6f42c1' },
            'admin': { class: 'role-admin', text: 'ผู้ดูแล', avatar: '#007bff' },
            'moderator': { class: 'role-moderator', text: 'ผู้ช่วยดูแล', avatar: '#28a745' }
        };

        // Department mapping
        const departmentMap = {
            'management': 'บริหาร',
            'sales': 'ขาย',
            'warehouse': 'คลังสินค้า',
            'logistics': 'ขนส่ง',
            'accounting': 'บัญชี',
            'it': 'เทคโนโลยีสารสนเทศ'
        };

        // Get role info
        function getRoleInfo(role) {
            return roleMap[role] || { class: 'role-moderator', text: 'ไม่ทราบ', avatar: '#6c757d' };
        }

        // Get status info
        function getStatusInfo(status) {
            const statusMap = {
                'active': { class: 'status-active', text: 'ใช้งานอยู่' },
                'inactive': { class: 'status-inactive', text: 'ไม่ได้ใช้งาน' }
            };
            return statusMap[status] || { class: 'status-inactive', text: 'ไม่ทราบ' };
        }

        // Get staff initials for avatar
        function getInitials(name) {
            return name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
        }

        // Render staff table
        function renderStaff() {
            const tbody = document.getElementById('staffTableBody');
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageStaff = filteredStaff.slice(startIndex, endIndex);

            tbody.innerHTML = pageStaff.map(person => {
                const roleInfo = getRoleInfo(person.role);
                const statusInfo = getStatusInfo(person.status);
                const initials = getInitials(person.name);
                const departmentName = departmentMap[person.department] || person.department;
                
                return `
                    <tr>
                        <td>
                            <div class="staff-info">
                                <div class="staff-avatar" style="background: linear-gradient(45deg, ${roleInfo.avatar}, ${roleInfo.avatar}90)">
                                    ${initials}
                                </div>
                                <div class="staff-details">
                                    <div class="staff-name">${person.name}</div>
                                    <div class="staff-phone">${person.phone || 'ไม่ระบุ'}</div>
                                    <div class="staff-department">${person.code}</div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <span class="role-badge ${roleInfo.class}">${roleInfo.text}</span>
                        </td>
                        <td>
                            <span style="color: #666; font-weight: 500;">${departmentName}</span>
                        </td>
                        <td>
                            <span class="status-badge ${statusInfo.class}">${statusInfo.text}</span>
                        </td>
                        <td class="actions">
                            <button class="view-btn" onclick="viewStaffDetails(${person.id})" title="ดูรายละเอียด">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="edit-btn" onclick="editStaff(${person.id})" title="แก้ไข">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="toggle-btn" onclick="toggleStaffStatus(${person.id})" title="${person.status === 'active' ? 'ปิดใช้งาน' : 'เปิดใช้งาน'}">
                                <i class="fas fa-${person.status === 'active' ? 'ban' : 'check'}"></i>
                            </button>
                            ${person.role !== 'manager' ? `
                                <button class="delete-btn" onclick="deleteStaff(${person.id})" title="ลบ">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : ''}
                        </td>
                    </tr>
                `;
            }).join('');

            renderPagination();
            updateStats();
        }

        // Render pagination
        function renderPagination() {
            const totalPages = Math.ceil(filteredStaff.length / itemsPerPage);
            const pagination = document.getElementById('pagination');
            
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }

            let buttons = [];
            
            // Previous button
            buttons.push(`
                <button onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>
                    <i class="fas fa-chevron-left"></i>
                </button>
            `);

            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                buttons.push(`
                    <button onclick="changePage(${i})" ${i === currentPage ? 'class="active"' : ''}>
                        ${i}
                    </button>
                `);
            }

            // Next button
            buttons.push(`
                <button onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>
                    <i class="fas fa-chevron-right"></i>
                </button>
            `);

            pagination.innerHTML = buttons.join('');
        }

        // Change page
        function changePage(page) {
            const totalPages = Math.ceil(filteredStaff.length / itemsPerPage);
            if (page >= 1 && page <= totalPages) {
                currentPage = page;
                renderStaff();
            }
        }

        // Update statistics
        function updateStats() {
            const stats = {
                total: filteredStaff.length,
                active: filteredStaff.filter(s => s.status === 'active').length,
                manager: filteredStaff.filter(s => s.role === 'manager').length,
                sales: filteredStaff.filter(s => s.role === 'sales').length,
                warehouse: filteredStaff.filter(s => s.role === 'warehouse').length
            };

            document.getElementById('totalStaff').textContent = stats.total;
            document.getElementById('activeStaff').textContent = stats.active;
            document.getElementById('managerCount').textContent = stats.manager;
            document.getElementById('salesCount').textContent = stats.sales;
            document.getElementById('warehouseCount').textContent = stats.warehouse;
        }

        // Filter and search functions
        function applyFilters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const roleFilter = document.getElementById('roleFilter').value;
            const departmentFilter = document.getElementById('departmentFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;

            filteredStaff = staff.filter(person => {
                const matchesSearch = person.name.toLowerCase().includes(searchTerm) ||
                                    getRoleInfo(person.role).text.toLowerCase().includes(searchTerm) ||
                                    (person.code && person.code.toLowerCase().includes(searchTerm));
                
                const matchesRole = !roleFilter || person.role === roleFilter;
                const matchesDepartment = !departmentFilter || person.department === departmentFilter;
                const matchesStatus = !statusFilter || person.status === statusFilter;

                return matchesSearch && matchesRole && matchesDepartment && matchesStatus;
            });

            applySorting();
            currentPage = 1;
            renderStaff();
        }

        // Sort staff function
        function applySorting() {
            const sortBy = document.getElementById('sortFilter').value;
            
            filteredStaff.sort((a, b) => {
                switch (sortBy) {
                    case 'name':
                        return a.name.localeCompare(b.name, 'th');
                    case 'role':
                        return a.role.localeCompare(b.role);
                    case 'department':
                        return a.department.localeCompare(b.department);
                    default:
                        return 0;
                }
            });
        }

        // Update department and permissions based on role
        function updateDepartmentAndPermissions() {
            const role = document.getElementById('staffRole').value;
            const departmentSelect = document.getElementById('staffDepartment');
            const permissionCheckboxes = document.querySelectorAll('#permissionsGrid input[type="checkbox"]');
            
            // Clear all permissions first
            permissionCheckboxes.forEach(checkbox => {
                checkbox.checked = false;
                checkbox.disabled = false;
            });

            // Set department and permissions based on role
            switch (role) {
                case 'manager':
                    departmentSelect.value = 'management';
                    // Manager gets all 5 permissions
                    ['dashboard', 'products', 'orders', 'admins', 'reports'].forEach(perm => {
                        const checkbox = document.getElementById(`perm-${perm}`);
                        if (checkbox) checkbox.checked = true;
                    });
                    break;
                case 'sales':
                    departmentSelect.value = 'sales';
                    // Sales gets dashboard, products, orders
                    ['dashboard', 'products', 'orders'].forEach(perm => {
                        const checkbox = document.getElementById(`perm-${perm}`);
                        if (checkbox) checkbox.checked = true;
                    });
                    break;
                case 'warehouse':
                    departmentSelect.value = 'warehouse';
                    // Warehouse gets dashboard, products
                    ['dashboard', 'products'].forEach(perm => {
                        const checkbox = document.getElementById(`perm-${perm}`);
                        if (checkbox) checkbox.checked = true;
                    });
                    break;
                case 'shipping':
                    departmentSelect.value = 'logistics';
                    // Shipping gets dashboard, orders
                    ['dashboard', 'orders'].forEach(perm => {
                        const checkbox = document.getElementById(`perm-${perm}`);
                        if (checkbox) checkbox.checked = true;
                    });
                    break;
                case 'accounting':
                    departmentSelect.value = 'accounting';
                    // Accounting gets dashboard, orders, reports
                    ['dashboard', 'orders', 'reports'].forEach(perm => {
                        const checkbox = document.getElementById(`perm-${perm}`);
                        if (checkbox) checkbox.checked = true;
                    });
                    break;
                case 'super':
                    departmentSelect.value = 'it';
                    // Super admin gets all permissions and they're locked
                    permissionCheckboxes.forEach(checkbox => {
                        checkbox.checked = true;
                        checkbox.disabled = true;
                    });
                    break;
                case 'admin':
                    departmentSelect.value = 'it';
                    // Admin gets all except admin management
                    ['dashboard', 'products', 'orders', 'reports'].forEach(perm => {
                        const checkbox = document.getElementById(`perm-${perm}`);
                        if (checkbox) checkbox.checked = true;
                    });
                    break;
                case 'moderator':
                    departmentSelect.value = 'it';
                    // Moderator gets basic permissions
                    ['dashboard', 'products', 'orders'].forEach(perm => {
                        const checkbox = document.getElementById(`perm-${perm}`);
                        if (checkbox) checkbox.checked = true;
                    });
                    break;
            }
        }

        // Modal functions
        function openAddModal() {
            document.getElementById('modalTitle').textContent = 'เพิ่มพนักงานใหม่';
            document.getElementById('staffForm').reset();
            document.getElementById('staffActive').checked = true;
            currentEditId = null;
            
            // Show password fields for new staff
            document.getElementById('staffPassword').closest('.form-group').style.display = 'block';
            document.getElementById('staffPasswordConfirm').closest('.form-group').style.display = 'block';
            document.getElementById('staffPassword').required = true;
            document.getElementById('staffPasswordConfirm').required = true;
            
            updateDepartmentAndPermissions();
            document.getElementById('staffModal').style.display = 'block';
        }

        function closeModal() {
            document.getElementById('staffModal').style.display = 'none';
            currentEditId = null;
        }

        function closeStaffDetailsModal() {
            document.getElementById('staffDetailsModal').style.display = 'none';
        }

        // Staff CRUD operations
        function viewStaffDetails(id) {
            const person = staff.find(s => s.id === id);
            if (!person) return;

            const roleInfo = getRoleInfo(person.role);
            const statusInfo = getStatusInfo(person.status);
            const departmentName = departmentMap[person.department] || person.department;

            // Populate staff details
            document.getElementById('staffDetailsTitle').textContent = `รายละเอียดพนักงาน - ${person.name}`;
            document.getElementById('detailName').textContent = person.name;
            document.getElementById('detailPhone').textContent = person.phone || 'ไม่ระบุ';
            document.getElementById('detailCode').textContent = person.code || 'ไม่ระบุ';
            document.getElementById('detailRole').innerHTML = `<span class="role-badge ${roleInfo.class}">${roleInfo.text}</span>`;
            document.getElementById('detailDepartment').textContent = departmentName;
            document.getElementById('detailStatus').innerHTML = `<span class="status-badge ${statusInfo.class}">${statusInfo.text}</span>`;
            document.getElementById('detailNotes').textContent = person.notes || 'ไม่มีหมายเหตุ';

            // Populate permissions
            const permissionsContainer = document.getElementById('detailPermissions');
            const permissionLabels = {
                dashboard: 'แดชบอร์ด',
                products: 'จัดการสินค้า',
                orders: 'จัดการคำสั่งซื้อ',
                admins: 'จัดการผู้ดูแล',
                reports: 'รายงาน'
            };

            permissionsContainer.innerHTML = person.permissions.map(perm => `
                <div style="padding: 8px; background: white; border-radius: 6px; display: flex; align-items: center; gap: 8px;">
                    <i class="fas fa-check" style="color: #28a745;"></i>
                    <span>${permissionLabels[perm] || perm}</span>
                </div>
            `).join('');

            document.getElementById('staffDetailsModal').style.display = 'block';
        }

        function editStaff(id) {
            const person = staff.find(s => s.id === id);
            if (!person) return;

            currentEditId = id;
            document.getElementById('modalTitle').textContent = 'แก้ไขข้อมูลพนักงาน';
            document.getElementById('staffName').value = person.name;
            document.getElementById('staffPhone').value = person.phone || '';
            document.getElementById('staffCode').value = person.code || '';
            document.getElementById('staffRole').value = person.role;
            document.getElementById('staffDepartment').value = person.department;
            document.getElementById('staffActive').checked = person.status === 'active';
            document.getElementById('staffNotes').value = person.notes || '';
            
            // Hide password fields for editing
            document.getElementById('staffPassword').closest('.form-group').style.display = 'none';
            document.getElementById('staffPasswordConfirm').closest('.form-group').style.display = 'none';
            document.getElementById('staffPassword').required = false;
            document.getElementById('staffPasswordConfirm').required = false;

            // Set permissions
            updateDepartmentAndPermissions();
            person.permissions.forEach(perm => {
                const checkbox = document.getElementById(`perm-${perm}`);
                if (checkbox && !checkbox.disabled) {
                    checkbox.checked = true;
                }
            });

            document.getElementById('staffModal').style.display = 'block';
        }

        function toggleStaffStatus(id) {
            const person = staff.find(s => s.id === id);
            if (!person) return;

            const newStatus = person.status === 'active' ? 'inactive' : 'active';
            const statusText = newStatus === 'active' ? 'เปิดใช้งาน' : 'ปิดใช้งาน';
            
            if (confirm(`คุณแน่ใจหรือไม่ว่าต้องการ${statusText} "${person.name}"?`)) {
                person.status = newStatus;
                applyFilters();
                showNotification(`${statusText} "${person.name}" แล้ว`, 'success');
            }
        }

        function deleteStaff(id) {
            const person = staff.find(s => s.id === id);
            if (!person) return;

            if (person.role === 'manager') {
                showNotification('ไม่สามารถลบผู้จัดการได้', 'error');
                return;
            }

            if (confirm(`คุณแน่ใจหรือไม่ว่าต้องการลบ "${person.name}"?\n\nการกระทำนี้ไม่สามารถย้อนกลับได้`)) {
                staff = staff.filter(s => s.id !== id);
                applyFilters();
                showNotification(`ลบพนักงาน "${person.name}" แล้ว`, 'success');
            }
        }

        // Validate form
        function validateForm() {
            const password = document.getElementById('staffPassword').value;
            const passwordConfirm = document.getElementById('staffPasswordConfirm').value;
            const code = document.getElementById('staffCode').value;

            // Check if staff code already exists
            if (code) {
                const existingCode = staff.find(s => s.code === code && s.id !== currentEditId);
                if (existingCode) {
                    showNotification('รหัสพนักงานนี้มีผู้ใช้งานแล้ว', 'error');
                    return false;
                }
            }

            // Check password for new staff
            if (!currentEditId) {
                if (password.length < 8) {
                    showNotification('รหัสผ่านต้องมีอย่างน้อย 8 ตัวอักษร', 'error');
                    return false;
                }

                if (password !== passwordConfirm) {
                    showNotification('รหัสผ่านไม่ตรงกัน', 'error');
                    return false;
                }
            }

            return true;
        }

        // Save staff form
        document.getElementById('staffForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!validateForm()) {
                return;
            }

            // Get selected permissions
            const selectedPermissions = [];
            document.querySelectorAll('#permissionsGrid input[type="checkbox"]:checked').forEach(checkbox => {
                selectedPermissions.push(checkbox.value);
            });

            const formData = {
                name: document.getElementById('staffName').value,
                phone: document.getElementById('staffPhone').value,
                code: document.getElementById('staffCode').value,
                role: document.getElementById('staffRole').value,
                department: document.getElementById('staffDepartment').value,
                status: document.getElementById('staffActive').checked ? 'active' : 'inactive',
                permissions: selectedPermissions,
                notes: document.getElementById('staffNotes').value
            };

            if (currentEditId) {
                // Update existing staff
                const staffIndex = staff.findIndex(s => s.id === currentEditId);
                if (staffIndex !== -1) {
                    staff[staffIndex] = { ...staff[staffIndex], ...formData };
                    showNotification('แก้ไขข้อมูลพนักงานเรียบร้อยแล้ว', 'success');
                }
            } else {
                // Add new staff
                const newStaff = {
                    id: Date.now(),
                    ...formData
                };
                staff.push(newStaff);
                showNotification('เพิ่มพนักงานเรียบร้อยแล้ว', 'success');
            }

            closeModal();
            applyFilters();
            
            // Reset form visibility
            document.getElementById('staffPassword').closest('.form-group').style.display = 'block';
            document.getElementById('staffPasswordConfirm').closest('.form-group').style.display = 'block';
            document.getElementById('staffPassword').required = true;
            document.getElementById('staffPasswordConfirm').required = true;
        });

        // Show notification function
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                padding: 15px 20px;
                border-radius: 8px;
                color: white;
                font-weight: 600;
                z-index: 3000;
                opacity: 0;
                transform: translateX(100%);
                transition: all 0.3s ease;
                ${type === 'success' ? 'background: #28a745;' : ''}
                ${type === 'error' ? 'background: #dc3545;' : ''}
                ${type === 'info' ? 'background: #17a2b8;' : ''}
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.opacity = '1';
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // Advanced search with debounce
        let searchTimeout;
        function debounceSearch() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(applyFilters, 300);
        }

        // Sort staff when dropdown changes
        function onSortChange() {
            applySorting();
            renderStaff();
        }

        // Toggle sidebar
        function toggleSidebar() {
            const sidebar = document.getElementById("sidebar");
            const main = document.querySelector(".main-content");

            if (sidebar) {
                sidebar.classList.toggle("show");
                main.classList.toggle("overlay");
            }
        }

        // Show different sections
        function showSection(section) {
            if (section === 'dashboard') {
                window.location.href = 'dashboard_admin.html';
            } else if (section === 'products') {
                window.location.href = 'products_admin.html';
            } else if (section === 'orders') {
                window.location.href = 'orders_admin.html';
            } else if (section === 'reports') {
                window.location.href = 'reports_admin.html';
            } else if (section === 'admins') {
                if (window.innerWidth <= 768) {
                    const sidebar = document.getElementById("sidebar");
                    const main = document.querySelector(".main-content");
                    if (sidebar) {
                        sidebar.classList.remove("show");
                        main.classList.remove("overlay");
                    }
                }
            }
        }

        // Close sidebar when clicking outside (mobile only)
        document.addEventListener("click", function (e) {
            const sidebar = document.getElementById("sidebar");
            const toggle = document.querySelector(".navbar-toggle");
            const main = document.querySelector(".main-content");

            if (!sidebar) return;

            const clickedOutside = !sidebar.contains(e.target) && !toggle.contains(e.target);

            if (sidebar.classList.contains("show") && clickedOutside && window.innerWidth <= 768) {
                sidebar.classList.remove("show");
                main.classList.remove("overlay");
            }
        });

        // Export functions for global access
        window.viewStaffDetails = viewStaffDetails;
        window.editStaff = editStaff;
        window.deleteStaff = deleteStaff;
        window.toggleStaffStatus = toggleStaffStatus;
        window.openAddModal = openAddModal;
        window.closeModal = closeModal;
        window.closeStaffDetailsModal = closeStaffDetailsModal;
        window.changePage = changePage;
        window.toggleSidebar = toggleSidebar;
        window.showSection = showSection;
        window.updateDepartmentAndPermissions = updateDepartmentAndPermissions;

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Initial render
            renderStaff();
            
            // Set up event listeners
            document.getElementById('searchInput').addEventListener('input', debounceSearch);
            document.getElementById('roleFilter').addEventListener('change', applyFilters);
            document.getElementById('departmentFilter').addEventListener('change', applyFilters);
            document.getElementById('statusFilter').addEventListener('change', applyFilters);
            document.getElementById('sortFilter').addEventListener('change', onSortChange);
            
            // Close modals when clicking outside
            document.getElementById('staffModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });
            
            document.getElementById('staffDetailsModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeStaffDetailsModal();
                }
            });
            
            // Close modals with Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    if (document.getElementById('staffModal').style.display === 'block') {
                        closeModal();
                    }
                    if (document.getElementById('staffDetailsModal').style.display === 'block') {
                        closeStaffDetailsModal();
                    }
                }
            });
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl+N or Cmd+N for new staff
            if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                e.preventDefault();
                openAddModal();
            }
            
            // Ctrl+F or Cmd+F for search focus
            if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
                e.preventDefault();
                document.getElementById('searchInput').focus();
            }
        });

        // Generate staff report
        function generateStaffReport() {
            const reportData = {
                totalStaff: staff.length,
                byRole: {},
                byDepartment: {},
                byStatus: {}
            };

            // Count by role, department, and status
            staff.forEach(person => {
                reportData.byRole[person.role] = (reportData.byRole[person.role] || 0) + 1;
                reportData.byDepartment[person.department] = (reportData.byDepartment[person.department] || 0) + 1;
                reportData.byStatus[person.status] = (reportData.byStatus[person.status] || 0) + 1;
            });

            console.log('Staff Report:', reportData);
            showNotification('รายงานถูกสร้างแล้ว (ดูใน Console)', 'success');
        }

        // Export staff data to CSV (basic implementation)
        function exportStaffData() {
            const csvContent = [
                ['ชื่อ', 'รหัสพนักงาน', 'บทบาท', 'แผนก', 'สถานะ'],
                ...staff.map(person => [
                    person.name,
                    person.code || '',
                    getRoleInfo(person.role).text,
                    departmentMap[person.department] || person.department,
                    getStatusInfo(person.status).text
                ])
            ].map(row => row.join(',')).join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', 'staff_data.csv');
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('ข้อมูลพนักงานถูกส่งออกแล้ว', 'success');
        }

        // Add export buttons functionality (these would be added to the UI if needed)
        window.generateStaffReport = generateStaffReport;
        window.exportStaffData = exportStaffData;
    </script>
</body>
</html>